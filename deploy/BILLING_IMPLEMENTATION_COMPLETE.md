# ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –±–∏–ª–ª–∏–Ω–≥–∞ –∏ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –ÆKassa - –ó–ê–í–ï–†–®–ï–ù–û

## üìã –û–±–∑–æ—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–ø–ª–∞—Ç—ã –∏ –±–∏–ª–ª–∏–Ω–≥–∞ –¥–ª—è Telegram Media Generator Bot —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ÆKassa, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –±–∞–ª–∞–Ω—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–∏—Å—Ç–µ–º–æ–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

---

## üóÇÔ∏è –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLAlchemy + Alembic)

#### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (`app/db/models.py`)

**–¢–∞–±–ª–∏—Ü–∞ `users`:**
- `id` - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `telegram_id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
- `created_at` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` - –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `free_operations_left` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0, –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ = 4)

**–¢–∞–±–ª–∏—Ü–∞ `balances`:**
- `id` - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `user_id` - –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ users.id (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `balance` - –±–∞–ª–∞–Ω—Å –≤ —Ä—É–±–ª—è—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)
- `updated_at` - –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–¢–∞–±–ª–∏—Ü–∞ `payments`:**
- `id` - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `user_id` - –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ users.id
- `yookassa_payment_id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–ª–∞—Ç–µ–∂–∞ –≤ –ÆKassa
- `amount` - —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ –≤ —Ä—É–±–ª—è—Ö
- `status` - —Å—Ç–∞—Ç—É—Å (pending, succeeded, canceled, failed, refunded)
- `raw_data` - JSON —Å –¥–∞–Ω–Ω—ã–º–∏ webhook –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- `created_at` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` - –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–¢–∞–±–ª–∏—Ü–∞ `operations`:**
- `id` - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `user_id` - –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ users.id
- `type` - —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (generate, edit, merge, face_swap, retouch, upscale)
- `price` - —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ä—É–±–ª—è—Ö (0 –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö)
- `status` - —Å—Ç–∞—Ç—É—Å (free, charged, refunded, failed)
- `task_id` - —Å–≤—è–∑—å —Å –∑–∞–¥–∞—á–µ–π RQ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `created_at` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î (`app/db/base.py`)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SQLAlchemy engine
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL –∏ SQLite
- –§–∞–±—Ä–∏–∫–∞ —Å–µ—Å—Å–∏–π –ë–î
- –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î

#### –ú–∏–≥—Ä–∞—Ü–∏–∏ (Alembic)
- `alembic.ini` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
- `alembic/env.py` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- `alembic/versions/001_initial_billing_tables.py` - –ø–µ—Ä–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü

---

### 2. –°–µ—Ä–≤–∏—Å—ã

#### –°–µ—Ä–≤–∏—Å –±–∏–ª–ª–∏–Ω–≥–∞ (`app/services/billing.py`)

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

1. **`get_or_create_user(telegram_id)`**
   - –ü–æ–ª—É—á–∞–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–∞–µ—Ç 4 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –±–∞–ª–∞–Ω—Å–∞ (0‚ÇΩ)

2. **`charge_operation(user_id, operation_type, task_id)`**
   - –ê—Ç–æ–º–∞—Ä–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
   - –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Üí —É–º–µ–Ω—å—à–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫
   - –ï—Å–ª–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –Ω–µ—Ç ‚Üí —Å–ø–∏—Å—ã–≤–∞–µ—Ç 10‚ÇΩ —Å –±–∞–ª–∞–Ω—Å–∞
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `operations`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ë–î –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: (success, error_message, operation_id)

3. **`refund_operation(operation_id)`**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
   - –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (status = charged)
   - –î–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ—á–∞–µ—Ç –∫–∞–∫ refunded

4. **`add_balance(user_id, amount)`**
   - –ü–æ–ø–æ–ª–Ω—è–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π

5. **`get_user_info(telegram_id)`**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞–ª–∞–Ω—Å–µ –∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–æ–º–∞–Ω–¥–µ `/balance`

#### –°–µ—Ä–≤–∏—Å –ø–ª–∞—Ç–µ–∂–µ–π (`app/services/payment.py`)

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

1. **`create_payment(user_id, amount, description)`**
   - –°–æ–∑–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ –≤ –ÆKassa —á–µ—Ä–µ–∑ API
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–ª–∞—Ç–µ–∂ –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`
   - –ü–µ—Ä–µ–¥–∞–µ—Ç –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ `telegram_user_id` –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π `payment_id`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É (`confirmation_url`)

2. **`process_webhook(webhook_data)`**
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç webhook –æ—Ç –ÆKassa
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ (`payment.succeeded`)
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ –ë–î)
   - –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ –ø–æ–ø–æ–ª–Ω—è–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –≤ –ë–î

3. **`get_payment_status(payment_id)`**
   - –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –∏–∑ –ë–î
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –æ–ø–ª–∞—Ç—ã

---

### 3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–æ—Ç–∞ (`app/bot/handlers/billing.py`)

#### –ö–æ–º–∞–Ω–¥—ã –∏ callback'–∏:

1. **`/balance`** - –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –±–∞–ª–∞–Ω—Å–∞
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –≤ —Ä—É–±–ª—è—Ö
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (N –∏–∑ 4)
   - –ö–Ω–æ–ø–∫–∞ "–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å"

2. **`payment_menu`** - –º–µ–Ω—é –æ–ø–ª–∞—Ç—ã
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –ö–Ω–æ–ø–∫–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—É–º–º: 100‚ÇΩ, 300‚ÇΩ, 500‚ÇΩ, 1000‚ÇΩ
   - –ö–Ω–æ–ø–∫–∞ "–î—Ä—É–≥–∞—è —Å—É–º–º–∞" –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π —Å—É–º–º—ã
   - –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞"

3. **`payment_amount_{amount}`** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—É–º–º
   - –°–æ–∑–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ –≤ –ÆKassa
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É

4. **`payment_custom`** - –∑–∞–ø—Ä–æ—Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π —Å—É–º–º—ã
   - –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤–≤–æ–¥–∞ —Å—É–º–º—ã
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –º–∏–Ω–∏–º—É–º 10‚ÇΩ, —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ

5. **`check_balance_decorator(operation_type)`** - –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –ï—Å–ª–∏ –µ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö
   - –ï—Å–ª–∏ –Ω–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö ‚Üí —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Å –±–∞–ª–∞–Ω—Å–∞
   - –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ —Å—Ä–µ–¥—Å—Ç–≤ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –æ–ø–ª–∞—Ç—ã
   - –ü–µ—Ä–µ–¥–∞–µ—Ç `operation_id` –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–≤—è–∑–∏ —Å –æ–ø–µ—Ä–∞—Ü–∏–µ–π –±–∏–ª–ª–∏–Ω–≥–∞

---

### 4. Webhook API (`app/web/billing.py`)

#### Endpoints:

1. **`POST /yookassa/webhook`**
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç –ÆKassa
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `payment.succeeded`
   - –í—ã–∑—ã–≤–∞–µ—Ç `PaymentService.process_webhook()`
   - –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

2. **`GET /yookassa/health`**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –±–∏–ª–ª–∏–Ω–≥–∞
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ª–∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ÆKassa

---

### 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### –û–±–Ω–æ–≤–ª–µ–Ω `env.prod.example`:

```bash
# Billing Configuration
PRICE_PER_OPERATION=10
FREE_OPERATIONS_COUNT=4

# Database Configuration
DATABASE_URL=sqlite:///./media_lab.db  # –∏–ª–∏ postgresql://...

# YooKassa Configuration
YOOKASSA_SHOP_ID=your_shop_id
YOOKASSA_SECRET_KEY=your_secret_key
YOOKASSA_RETURN_URL=https://t.me/your_bot
YOOKASSA_CURRENCY=RUB
YOOKASSA_WEBHOOK_URL=https://your-domain.com/yookassa/webhook
```

#### –°–æ–∑–¥–∞–Ω `requirements-billing.txt`:

```
sqlalchemy>=2.0.0
alembic>=1.13.0
httpx>=0.27.0
# psycopg2-binary>=2.9.9  # –¥–ª—è PostgreSQL
```

---

### 6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:

1. **`BILLING_SUMMARY.md`** - —Ä–µ–∑—é–º–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
   - –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
   - –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
   - –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

2. **`BILLING_DEPLOYMENT.md`** - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
   - –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –ÆKassa
   - –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

3. **`BILLING_INTEGRATION_GUIDE.md`** - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –≤ –º–µ–Ω—é
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –≤–æ—Ä–∫–µ—Ä–∞—Ö
   - –ú–∞–ø–ø–∏–Ω–≥ —Ä–µ–∂–∏–º–æ–≤ –Ω–∞ —Ç–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

4. **`INTEGRATION_EXAMPLES.md`** - –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
   - –ü—Ä–∏–º–µ—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤
   - –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
   - –ü—Ä–∏–º–µ—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

5. **`BILLING_QUICK_START.md`** - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
   - –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–∞ 5 –º–∏–Ω—É—Ç

6. **`BILLING_IMPLEMENTATION_PLAN.md`** - –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
   - –ú–æ–¥–µ–ª–∏ –ë–î
   - –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã

---

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start` –≤–ø–µ—Ä–≤—ã–µ
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `users` —Å `free_operations_left = 4`
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `balances` —Å `balance = 0`
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç 4 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### –ü–ª–∞—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –ø–ª–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°–æ–∑–¥–∞—Ç—å")
2. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä `@check_balance_decorator("generate")` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å:
   - –ï—Å–ª–∏ `free_operations_left > 0`:
     - –£–º–µ–Ω—å—à–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫ –Ω–∞ 1
     - –°–æ–∑–¥–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `free` –∏ `price = 0`
     - –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á—É
   - –ï—Å–ª–∏ `free_operations_left = 0`:
     - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å
     - –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å >= 10‚ÇΩ:
       - –°–ø–∏—Å—ã–≤–∞–µ—Ç 10‚ÇΩ
       - –°–æ–∑–¥–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `charged` –∏ `price = 10`
       - –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á—É
     - –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å < 10‚ÇΩ:
       - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
       - –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å"
       - –ó–∞–¥–∞—á–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

### –û–ø–ª–∞—Ç–∞

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üí∞ –û–ø–ª–∞—Ç–∏—Ç—å / –ë–∞–ª–∞–Ω—Å"
2. –í—ã–±–∏—Ä–∞–µ—Ç —Å—É–º–º—É (100/300/500/1000 –∏–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é)
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–ª–∞—Ç–µ–∂ –≤ –ÆKassa —á–µ—Ä–µ–∑ API
4. –ü–ª–∞—Ç–µ–∂ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç —á–µ—Ä–µ–∑ –ÆKassa
7. –ÆKassa –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ `/yookassa/webhook`
8. Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
   - –ï—Å–ª–∏ `succeeded` –∏ –µ—â–µ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω:
     - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –≤ –ë–î
     - –ü–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏—è

### –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ

1. –í –≤–æ—Ä–∫–µ—Ä–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–π–º–∞—É—Ç Fal.ai)
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `operation_id` –∑–∞–¥–∞—á–∏
3. –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –±—ã–ª–∞ –ø–ª–∞—Ç–Ω–æ–π (`status = charged`):
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `BillingService.refund_operation()`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 10‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å
   - –û–ø–µ—Ä–∞—Ü–∏—è –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `refunded`
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º "–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç"

- –†–µ–∂–∏–º "üìù –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç" –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –±–∏–ª–ª–∏–Ω–≥
- –ù–µ —Ç—Ä–∞—Ç–∏—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ù–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ–Ω—å–≥–∏
- –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

---

## üìä –ü–ª–∞—Ç–Ω—ã–µ –∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ä–µ–∂–∏–º—ã

### –ü–ª–∞—Ç–Ω—ã–µ —Ä–µ–∂–∏–º—ã (10‚ÇΩ –∑–∞ –æ–ø–µ—Ä–∞—Ü–∏—é):

- üé® **–°–æ–∑–¥–∞—Ç—å** (`generate`)
- ‚úèÔ∏è **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å** (`edit`)
- üîó **–û–±—ä–µ–¥–∏–Ω–∏—Ç—å ‚ûï –î–æ–±–∞–≤–∏—Ç—å** (`merge`)
- üîÑ **–ó–∞–º–µ–Ω–∏—Ç—å –ª–∏—Ü–æ** (`face_swap`)
- ‚ú® **–†–µ—Ç—É—à—å** (`retouch`)
- ‚¨ÜÔ∏è **–£–ª—É—á—à–∏—Ç—å** (`upscale`)

### –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º:

- üìù **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç** (`add_text`) - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ–ø–ª–∞—Ç—ã

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã:

1. **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ë–î
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ `with_for_update()` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è race conditions

2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ –ø–µ—Ä–µ–¥ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –±–∞–ª–∞–Ω—Å–∞
   - –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å webhook –æ–±—Ä–∞–±–æ—Ç–∫–∏

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞: 10‚ÇΩ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å—Ä–µ–¥—Å—Ç–≤ –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–∏–ª–ª–∏–Ω–≥–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
   - Webhook –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
   - –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º traceback

---

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–æ—É—Ç–µ—Ä—ã

**–í `app/bot/main.py`:**
```python
from app.bot.handlers import billing
router.include_router(billing.router)
```

**–í `app/web/api.py`:**
```python
from app.web import billing
app.include_router(billing.router)
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –≤ –ø–ª–∞—Ç–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –¥–æ–±–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä:
```python
from app.bot.handlers.billing import check_balance_decorator

@check_balance_decorator("generate")  # –∏–ª–∏ "edit", "merge", –∏ —Ç.–¥.
async def handle_generate(...):
    ...
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

–í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ `/start` –¥–æ–±–∞–≤–∏—Ç—å:
```python
InlineKeyboardButton(text="üí∞ –û–ø–ª–∞—Ç–∏—Ç—å / –ë–∞–ª–∞–Ω—Å", callback_data="payment_menu")
```

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –≤–æ—Ä–∫–µ—Ä–∞—Ö

–í –≤–æ—Ä–∫–µ—Ä–∞—Ö –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤:
```python
if operation_id:
    BillingService.refund_operation(db, operation_id)
```

### 5. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

1. –û–±–Ω–æ–≤–∏—Ç—å `.env` —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –±–∏–ª–ª–∏–Ω–≥–∞
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `pip install sqlalchemy alembic`
3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏: `alembic upgrade head`
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook URL –≤ –ÆKassa
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

```
app/
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ base.py              ‚úÖ –°–æ–∑–¥–∞–Ω
‚îÇ   ‚îú‚îÄ‚îÄ models.py            ‚úÖ –°–æ–∑–¥–∞–Ω
‚îÇ   ‚îî‚îÄ‚îÄ session.py           ‚úÖ –°–æ–∑–¥–∞–Ω
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ billing.py           ‚úÖ –°–æ–∑–¥–∞–Ω
‚îÇ   ‚îî‚îÄ‚îÄ payment.py            ‚úÖ –°–æ–∑–¥–∞–Ω
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îî‚îÄ‚îÄ handlers/
‚îÇ       ‚îî‚îÄ‚îÄ billing.py       ‚úÖ –°–æ–∑–¥–∞–Ω
‚îî‚îÄ‚îÄ web/
    ‚îî‚îÄ‚îÄ billing.py            ‚úÖ –°–æ–∑–¥–∞–Ω

alembic/
‚îú‚îÄ‚îÄ __init__.py              ‚úÖ –°–æ–∑–¥–∞–Ω
‚îú‚îÄ‚îÄ env.py                   ‚úÖ –°–æ–∑–¥–∞–Ω
‚îú‚îÄ‚îÄ script.py.mako           ‚úÖ –°–æ–∑–¥–∞–Ω
‚îî‚îÄ‚îÄ versions/
    ‚îú‚îÄ‚îÄ .gitkeep
    ‚îî‚îÄ‚îÄ 001_initial_billing_tables.py  ‚úÖ –°–æ–∑–¥–∞–Ω

alembic.ini                   ‚úÖ –°–æ–∑–¥–∞–Ω
requirements-billing.txt      ‚úÖ –°–æ–∑–¥–∞–Ω
env.prod.example              ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
‚îú‚îÄ‚îÄ BILLING_SUMMARY.md                    ‚úÖ –°–æ–∑–¥–∞–Ω
‚îú‚îÄ‚îÄ BILLING_DEPLOYMENT.md                  ‚úÖ –°–æ–∑–¥–∞–Ω
‚îú‚îÄ‚îÄ BILLING_INTEGRATION_GUIDE.md          ‚úÖ –°–æ–∑–¥–∞–Ω
‚îú‚îÄ‚îÄ INTEGRATION_EXAMPLES.md               ‚úÖ –°–æ–∑–¥–∞–Ω
‚îú‚îÄ‚îÄ BILLING_QUICK_START.md                 ‚úÖ –°–æ–∑–¥–∞–Ω
‚îú‚îÄ‚îÄ BILLING_IMPLEMENTATION_PLAN.md         ‚úÖ –°–æ–∑–¥–∞–Ω
‚îî‚îÄ‚îÄ BILLING_IMPLEMENTATION_COMPLETE.md     ‚úÖ –°–æ–∑–¥–∞–Ω (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
```

---

## ‚úÖ –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- ‚úÖ –ú–æ–¥–µ–ª–∏ –ë–î (4 —Ç–∞–±–ª–∏—Ü—ã)
- ‚úÖ –°–µ—Ä–≤–∏—Å –±–∏–ª–ª–∏–Ω–≥–∞ (–±–∞–ª–∞–Ω—Å, –æ–ø–µ—Ä–∞—Ü–∏–∏, —Å–ø–∏—Å–∞–Ω–∏—è)
- ‚úÖ –°–µ—Ä–≤–∏—Å –ø–ª–∞—Ç–µ–∂–µ–π –ÆKassa (—Å–æ–∑–¥–∞–Ω–∏–µ, webhook)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–æ—Ç–∞ (–∫–æ–º–∞–Ω–¥—ã, –º–µ–Ω—é –æ–ø–ª–∞—Ç—ã)
- ‚úÖ Webhook endpoint –¥–ª—è –ÆKassa
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (.env)
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (6 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)

**–ì–æ—Ç–æ–≤–æ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏!**

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å `BILLING_INTEGRATION_GUIDE.md`
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–æ—É—Ç–µ—Ä—ã –≤ `main.py` –∏ `api.py`
3. –î–æ–±–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –≤ –ø–ª–∞—Ç–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
4. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û–ø–ª–∞—Ç–∏—Ç—å" –≤ –º–µ–Ω—é
5. –û–±–Ω–æ–≤–∏—Ç—å `.env` –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
6. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É

–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å–º. –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤—ã—à–µ.



