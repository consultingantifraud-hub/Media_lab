# –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã Telegram Media Generator Bot

## üìã –û–±–∑–æ—Ä

Telegram Media Generator Bot ‚Äî —ç—Ç–æ –±–æ—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é AI. –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç aiogram 3 –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ Fal.ai API –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–æ—Ç–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Telegram Bot** (`app/bot/`)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞–º–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ (FSM)
   - –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥—å Redis
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

2. **RQ Workers** (`app/workers/`)
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Fal.ai API
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∑–∞–¥–∞—á

3. **Redis Queue**
   - –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (RQ)
   - –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM
   - –•—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–¥–∞—á

## üîÑ –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞

### –û–±—â–∏–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Telegram Bot ‚Üí Redis Queue ‚Üí RQ Worker ‚Üí Fal.ai API ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
```

### –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ**
   - –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram Bot API
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è (–∫–æ–º–∞–Ω–¥–∞, —Ç–µ–∫—Å—Ç, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥**
   - –ë–æ—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (FSM)
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫

3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ (FSM)**
   - –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Finite State Machine –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞–º–∏
   - –ö–∞–∂–¥—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –∏–º–µ–µ—Ç —Å–≤–æ–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –°–æ—Å—Ç–æ—è–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Redis

4. **–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å**
   - –ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–∞—á—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∑–∞–ø—Ä–æ—Å–∞
   - –ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ Redis Queue (`img_queue`)
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏

5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á–∏ –≤–æ—Ä–∫–µ—Ä–æ–º**
   - RQ Worker –∑–∞–±–∏—Ä–∞–µ—Ç –∑–∞–¥–∞—á—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∫ Fal.ai API
   - –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ

6. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**
   - –í–æ—Ä–∫–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ –±–æ—Ç (—á–µ—Ä–µ–∑ Redis –∏–ª–∏ callback)
   - –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram

## üéØ –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–ì–µ–Ω–µ—Ä–∞—Ü–∏—è)

**–ö–æ–º–∞–Ω–¥–∞:** `/start` ‚Üí –í—ã–±–æ—Ä "üé® –°–æ–∑–¥–∞—Ç—å"

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –º–æ–¥–µ–ª—å (Nano-banana –∏–ª–∏ Flux Ultra)
2. –í—ã–±–∏—Ä–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ, –∫–≤–∞–¥—Ä–∞—Ç, –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ)
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
4. –ë–æ—Ç —Å—Ç–∞–≤–∏—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
5. –í–æ—Ä–∫–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Fal.ai API
6. –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏:**
- `fal-ai/nano-banana` ‚Äî –ø—Ä–µ–º–∏—É–º –º–æ–¥–µ–ª—å (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫)
- `fal-ai/flux-pro/v1.1-ultra` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –º–æ–¥–µ–ª—å

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü—Ä–æ–º–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π (–∫—Ä–æ–º–µ Nano-banana)
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `media/images/`

### 2. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ö–æ–º–∞–Ω–¥–∞:** `/start` ‚Üí –í—ã–±–æ—Ä "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. –ë–æ—Ç —Å—Ç–∞–≤–∏—Ç –∑–∞–¥–∞—á—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å
4. –í–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ Fal.ai API
5. –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏:**
- `fal-ai/bytedance/seedream/v4/edit` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `fal-ai/chrono-edit` ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `media/edits/`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–ª–∞—Å—Ç–µ–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 3. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ö–æ–º–∞–Ω–¥–∞:** `/start` ‚Üí –í—ã–±–æ—Ä "üîó –û–±—ä–µ–¥–∏–Ω–∏—Ç—å ‚ûï –î–æ–±–∞–≤–∏—Ç—å"

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Ç–æ—Ä–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
4. –ë–æ—Ç —Å—Ç–∞–≤–∏—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
5. –í–æ—Ä–∫–µ—Ä –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Fal.ai API
6. –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏:**
- `fal-ai/bytedance/seedream/v4/edit` ‚Äî –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

**–ö–æ–º–∞–Ω–¥–∞:** `/start` ‚Üí –í—ã–±–æ—Ä "üìù –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç"

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   - –†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ (–º–∞–ª–µ–Ω—å–∫–∏–π, —Å—Ä–µ–¥–Ω–∏–π, –æ–±—ã—á–Ω—ã–π, –∫—Ä—É–ø–Ω—ã–π, –æ–≥—Ä–æ–º–Ω—ã–π –∏–ª–∏ –≤ –ø–∏–∫—Å–µ–ª—è—Ö)
   - –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
   - –ü–æ–∑–∏—Ü–∏—è (—Ü–µ–Ω—Ç—Ä, –≤–µ—Ä—Ö, –Ω–∏–∑, –ª–µ–≤–æ, –ø—Ä–∞–≤–æ)
   - –ü–ª–∞—à–∫–∞ (–¥–∞/–Ω–µ—Ç, —Ü–≤–µ—Ç, –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å, —Ä–∞–∑–º—ã—Ç–∏–µ)
   - –°–º–µ—â–µ–Ω–∏–µ –æ—Ç –Ω–∏–∑–∞ (–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö)
4. –ë–æ—Ç –ø–∞—Ä—Å–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ —á–µ—Ä–µ–∑ LLM (Gemini)
5. –ë–æ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ Fal.ai)
6. –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** –≤ –±–æ—Ç–µ (–±–µ–∑ –æ—á–µ—Ä–µ–¥–∏)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Pillow –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ç–µ–∫—Å—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —ç–º–æ–¥–∑–∏ —á–µ—Ä–µ–∑ Twemoji PNG —Ñ–∞–π–ª—ã
- LLM –ø–∞—Ä—Å–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:**
- `size`: —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ (—Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ —á–∏—Å–ª–æ –≤ –ø–∏–∫—Å–µ–ª—è—Ö)
- `color`: —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
- `position`: –ø–æ–∑–∏—Ü–∏—è –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
- `align`: –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ (left, center, right)
- `box`: –Ω–∞–ª–∏—á–∏–µ –ø–ª–∞—à–∫–∏
- `box_color`: —Ü–≤–µ—Ç –ø–ª–∞—à–∫–∏
- `box_alpha`: –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–ª–∞—à–∫–∏ (0.0-1.0)
- `box_blur`: —Ä–∞–¥–∏—É—Å —Ä–∞–∑–º—ã—Ç–∏—è –ø–ª–∞—à–∫–∏
- `box_radius`: —Ä–∞–¥–∏—É—Å —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è —É–≥–ª–æ–≤
- `offset_bottom`: —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç –Ω–∏–∑–∞ (0.0-1.0)

### 5. –ó–∞–º–µ–Ω–∞ –ª–∏—Ü–∞

**–ö–æ–º–∞–Ω–¥–∞:** `/start` ‚Üí –í—ã–±–æ—Ä "üîÑ –ó–∞–º–µ–Ω–∏—Ç—å –ª–∏—Ü–æ"

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ª–∏—Ü–æ–º
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ª–∏—Ü–æ–º –¥–ª—è –∑–∞–º–µ–Ω—ã
3. –ë–æ—Ç —Å—Ç–∞–≤–∏—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
4. –í–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ Fal.ai API
5. –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏:**
- `fal-ai/face-swap` ‚Äî –∑–∞–º–µ–Ω–∞ –ª–∏—Ü–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `media/face_swap/`

### 6. –†–µ—Ç—É—à—å –ª–∏—Ü–∞

**–ö–æ–º–∞–Ω–¥–∞:** `/start` ‚Üí –í—ã–±–æ—Ä "‚ú® –†–µ—Ç—É—à—å"

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ª–∏—Ü–æ–º
2. –ë–æ—Ç —Å—Ç–∞–≤–∏—Ç –∑–∞–¥–∞—á—É —Ä–µ—Ç—É—à–∏ –≤ –æ—á–µ—Ä–µ–¥—å
3. –í–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ Fal.ai API
4. –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏:**
- `fal-ai/retoucher` ‚Äî —Ä–µ—Ç—É—à—å –ª–∏—Ü–∞
- `fal-ai/image-editing/face-enhancement` ‚Äî —É–ª—É—á—à–µ–Ω–∏–µ –ª–∏—Ü–∞

### 7. –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ (Upscale)

**–ö–æ–º–∞–Ω–¥–∞:** `/start` ‚Üí –í—ã–±–æ—Ä "‚¨ÜÔ∏è –£–ª—É—á—à–∏—Ç—å"

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
2. –ë–æ—Ç —Å—Ç–∞–≤–∏—Ç –∑–∞–¥–∞—á—É —É–ª—É—á—à–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å
3. –í–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ Fal.ai API
4. –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏:**
- `fal-ai/recraft/upscale/crisp` ‚Äî —É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞

## üîÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ (FSM)

### –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç FSM (Finite State Machine) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞–º–∏. –ö–∞–∂–¥—ã–π —Ä–µ–∂–∏–º –∏–º–µ–µ—Ç —Å–≤–æ–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

#### –†–µ–∂–∏–º —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
- `WAIT_MODEL` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
- `WAIT_FORMAT` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞
- `WAIT_PROMPT` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

#### –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- `WAIT_IMAGE` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `WAIT_PROMPT` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –†–µ–∂–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞:
- `WAIT_TEXT` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
- `WAIT_HINT` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### –†–µ–∂–∏–º –∑–∞–º–µ–Ω—ã –ª–∏—Ü–∞:
- `WAIT_SOURCE_FACE` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –∏—Å—Ö–æ–¥–Ω—ã–º –ª–∏—Ü–æ–º
- `WAIT_TARGET_FACE` ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ª–∏—Ü–æ–º –¥–ª—è –∑–∞–º–µ–Ω—ã

### –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π

- –°–æ—Å—Ç–æ—è–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Redis —á–µ—Ä–µ–∑ aiogram FSM storage
- –ö–ª—é—á: `fsm:{user_id}:{state}`
- –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ –¥–∏–∞–ª–æ–≥–∞

## üì® –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

### –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π

1. **–ö–æ–º–∞–Ω–¥—ã** (`/start`, `/help`, `/cancel`)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å—Ä–∞–∑—É
   - –ú–æ–≥—É—Ç —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

2. **–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –ú–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–º–ø—Ç–∞–º–∏, –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∏ —Ç.–¥.

3. **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**
   - –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
   - –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
   - –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –≤–æ—Ä–∫–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

4. **Callback queries** (–∫–Ω–æ–ø–∫–∏)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–µ–π, —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∏ —Ç.–¥.
   - –û–±–Ω–æ–≤–ª—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á

**–û—á–µ—Ä–µ–¥—å:** `img_queue` –≤ Redis

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–¥–∞—á–∏:**
```python
{
    "task_id": "uuid",
    "user_id": 123456789,
    "chat_id": 123456789,
    "type": "generate|edit|face_swap|...",
    "model": "fal-ai/nano-banana",
    "prompt": "—Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞",
    "image_path": "/path/to/image.jpg",
    "format": "vertical|square|horizontal",
    "params": {...}  # –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
}
```

## ü§ñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM

### –ü–∞—Ä—Å–∏–Ω–≥ –æ–ø–∏—Å–∞–Ω–∏—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞

–î–ª—è —Ä–µ–∂–∏–º–∞ "–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç" –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ–ø–∏—Å–∞–Ω–∏—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è:

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ö—Ä—É–ø–Ω—ã–π –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç –≤ —Ü–µ–Ω—Ç—Ä–µ, –Ω–∞ —á—ë—Ä–Ω–æ–π –ø–ª–∞—à–∫–µ")
2. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –≤ LLM (Gemini Flash 1.5 –∏–ª–∏ Gemini Pro 1.5)
3. LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
   ```json
   {
     "size": "XL",
     "color": "white",
     "position": "center",
     "box": true,
     "box_color": "black",
     "box_alpha": 0.6
   }
   ```
4. –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ç–µ–∫—Å—Ç–∞

**–ú–æ–¥–µ–ª–∏ LLM:**
- `google/gemini-flash-1.5` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è (–±—ã—Å—Ç—Ä–∞—è)
- `google/gemini-pro-1.5` ‚Äî —Ä–µ–∑–µ—Ä–≤–Ω–∞—è (–±–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è)

**–¢–∞–π–º–∞—É—Ç—ã:**
- –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å: 10 —Å–µ–∫—É–Ω–¥
- –†–µ–∑–µ—Ä–≤–Ω–∞—è –º–æ–¥–µ–ª—å: 60 —Å–µ–∫—É–Ω–¥

## üé® –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ Telegram
   - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ RGBA —Ñ–æ—Ä–º–∞—Ç

2. **–ü–∞—Ä—Å–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**
   - LLM –ø–∞—Ä—Å–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞**
   - –¢–µ–∫—Å—Ç —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–æ–∫–∏ —Å —É—á–µ—Ç–æ–º –ø–µ—Ä–µ–Ω–æ—Å–æ–≤
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∏ –≤—ã—Å–æ—Ç–∞
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —è–≤–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ (`\n`)

4. **–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø–ª–∞—à–∫–∏** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–ª–∞—à–∫–∞ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —Ü–≤–µ—Ç–æ–º –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ä–∞–∑–º—ã—Ç–∏–µ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ)
   - –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ)

5. **–†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞**
   - –¢–µ–∫—Å—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º –∏ —Ä–∞–∑–º–µ—Ä–æ–º
   - –≠–º–æ–¥–∑–∏ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —á–µ—Ä–µ–∑ Twemoji PNG —Ñ–∞–π–ª—ã
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –æ–±–≤–æ–¥–∫–∞ –∏ —Ç–µ–Ω—å (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

6. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**
   - –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `media/images/`
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

- **–®—Ä–∏—Ñ—Ç—ã:** –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã (Roboto, Arial)
- **–≠–º–æ–¥–∑–∏:** –†–µ–Ω–¥–µ—Ä—è—Ç—Å—è —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω—ã–µ Twemoji PNG —Ñ–∞–π–ª—ã (–±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
- **–ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ –∫—Ä–∞—è–º
- **–ü–ª–∞—à–∫–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞
- **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∞–ª—å—Ñ–∞-–∫–∞–Ω–∞–ª

## üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø—ã –æ—à–∏–±–æ–∫

1. **–û—à–∏–±–∫–∏ Fal.ai API**
   - –¢–∞–π–º–∞—É—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ (429)
   - –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (422)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤–æ—Ä–∫–µ—Ä–æ–º, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

2. **–û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
   - –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
   - –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
   - –û—à–∏–±–∫–∏ —Å–∂–∞—Ç–∏—è
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –±–æ—Ç–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ

3. **–û—à–∏–±–∫–∏ LLM**
   - –¢–∞–π–º–∞—É—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞
   - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –º–æ–¥–µ–ª—å –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

4. **–û—à–∏–±–∫–∏ –æ—á–µ—Ä–µ–¥–∏**
   - Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
   - –û—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `loguru` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

- **INFO** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∫–æ–º–∞–Ω–¥—ã, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á)
- **WARNING** ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (—Ç–∞–π–º–∞—É—Ç—ã, fallback –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –º–æ–¥–µ–ª—å)
- **ERROR** ‚Äî –æ—à–∏–±–∫–∏ (—Å–±–æ–∏ API, –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏)

### –ú–µ—Ç—Ä–∏–∫–∏

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:**
- `tg_bot_token` ‚Äî —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `fal_api_key` ‚Äî API –∫–ª—é—á Fal.ai
- `app_env` ‚Äî —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (`vps` –∏–ª–∏ `local`)

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:**
- `redis_url` ‚Äî URL Redis (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `redis://redis:6379/0`)
- `log_level` ‚Äî —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `INFO`)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ–ª–µ–π

–ú–æ–¥–µ–ª–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `.env`:
- `fal_standard_model` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –º–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `fal_premium_model` ‚Äî –ø—Ä–µ–º–∏—É–º –º–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `fal_edit_model` ‚Äî –º–æ–¥–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `fal_upscale_model` ‚Äî –º–æ–¥–µ–ª—å —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
- –ò –¥—Ä—É–≥–∏–µ...

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**
   - –ó–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤–æ—Ä–∫–µ—Ä–∞–º–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
   - –ë–æ—Ç –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –¥–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –°–æ—Å—Ç–æ—è–Ω–∏—è FSM –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ Redis
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã LLM –º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å (–¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)

3. **–°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–æ–ª—å—à–µ 4 –ú–ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∂–∏–º–∞—é—Ç—Å—è
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JPEG —Å –∫–∞—á–µ—Å—Ç–≤–æ–º 50-85

4. **–õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞**
   - –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ Fal.ai)
   - –ë—ã—Å—Ç—Ä–µ–µ –∏ –¥–µ—à–µ–≤–ª–µ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **Fal.ai API:** 10 concurrent tasks –Ω–∞ –æ–¥–∏–Ω API –∫–ª—é—á (–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —á–µ—Ä–µ–∑ –ø–æ–∫—É–ø–∫—É –∫—Ä–µ–¥–∏—Ç–æ–≤)
- **–†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ–≥—Ä–∞–Ω–∏—á–µ–Ω Telegram API
- **–¢–∞–π–º–∞—É—Ç—ã:** –ó–∞–ø—Ä–æ—Å—ã –∫ Fal.ai –∏–º–µ—é—Ç —Ç–∞–π–º–∞—É—Ç—ã (60-180 —Å–µ–∫—É–Ω–¥)

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start
–ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º ‚Üí "üé® –°–æ–∑–¥–∞—Ç—å"
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –í—ã–±–∏—Ä–∞–µ—Ç "Nano-banana"
–ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç ‚Üí "–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ"
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–º–∞–ª–µ–Ω—å–∫–∞—è —Å–æ–±–∞–∫–∞ –≤ —à–ª—è–ø–µ"
–ë–æ—Ç: "üöÄ –ì–µ–Ω–µ—Ä–∏—Ä—É—é..."
[–ó–∞–¥–∞—á–∞ –≤ –æ—á–µ—Ä–µ–¥–∏ ‚Üí –í–æ—Ä–∫–µ—Ä ‚Üí Fal.ai ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç]
–ë–æ—Ç: [–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ]
```

### –ü—Ä–∏–º–µ—Ä 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start ‚Üí "üìù –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç"
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ]
–ë–æ—Ç: "–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç..."
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ö—Ä—É—Ç–æ üëç"
–ë–æ—Ç: "–û–ø–∏—à–∏—Ç–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ..."
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–û–≥—Ä–æ–º–Ω—ã–π –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É, –Ω–∞ —á—ë—Ä–Ω–æ–π –ø–ª–∞—à–∫–µ"
[LLM –ø–∞—Ä—Å–∏—Ç ‚Üí –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ]
–ë–æ—Ç: [–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç]
```

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `PROJECT_ANALYSIS.md` ‚Äî –æ–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- `README.md` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- `fal-ai-concurrency-solution.md` ‚Äî —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ª–∏–º–∏—Ç–∞–º–∏ Fal.ai




