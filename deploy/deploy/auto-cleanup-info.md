# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ Docker –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ Docker –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ **02:00 –ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏**.

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –°–∫—Ä–∏–ø—Ç –æ—á–∏—Å—Ç–∫–∏
- **–ü—É—Ç—å:** `/opt/media-lab/server-cleanup-auto.sh`
- **–õ–æ–≥–∏:** `/opt/media-lab/logs/docker-cleanup.log`

### Cron –∑–∞–¥–∞—á–∞
```bash
TZ=Europe/Moscow
0 2 * * * /opt/media-lab/server-cleanup-auto.sh >/dev/null 2>&1
```

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 02:00 –ú–°–ö (23:00 UTC –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–Ω—è)

## üîç –ß—Ç–æ –æ—á–∏—â–∞–µ—Ç—Å—è

1. **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã** (dangling images)
2. **Build cache** (—Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤)
3. **–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**
4. **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volumes**

**–í–∞–∂–Ω–æ:** –†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑—ã **–ù–ï —É–¥–∞–ª—è—é—Ç—Å—è**.

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏
tail -20 /opt/media-lab/logs/docker-cleanup.log

# –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f /opt/media-lab/logs/docker-cleanup.log

# –í—Å–µ –ª–æ–≥–∏
cat /opt/media-lab/logs/docker-cleanup.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä crontab
crontab -l

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ cron
systemctl status cron
# –∏–ª–∏
systemctl status crond
```

### –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É –≤—Ä—É—á–Ω—É—é
/opt/media-lab/server-cleanup-auto.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
docker system df
```

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –æ—á–∏—Å—Ç–∫–∏
```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å crontab
crontab -e

# –ò–ª–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
/opt/media-lab/setup-auto-cleanup.sh
```

### –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É
```bash
# –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É –∏–∑ crontab
crontab -e
# –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ —Å server-cleanup-auto.sh
```

### –í–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ
```bash
/opt/media-lab/setup-auto-cleanup.sh
```

## üìù –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞

```
[2025-11-19 02:00:01] === –ù–∞—á–∞–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ Docker ===
[2025-11-19 02:00:01] –¢–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker:
[2025-11-19 02:00:01] TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE
[2025-11-19 02:00:01] Images          4         4         3.185GB   0B
[2025-11-19 02:00:01] 1. –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤...
[2025-11-19 02:00:02] Total reclaimed space: 0B
[2025-11-19 02:00:02] 2. –û—á–∏—Å—Ç–∫–∞ Build Cache (—Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤)...
[2025-11-19 02:00:03] Total reclaimed space: 452.3MB
[2025-11-19 02:00:03] === –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ! ===
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–õ–æ–≥-—Ñ–∞–π–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω:** –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 1000 —Å—Ç—Ä–æ–∫
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –£–¥–∞–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã
3. **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** –û–±—ã—á–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
4. **–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `TZ=Europe/Moscow` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### Cron –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–ª—É–∂–±—ã
systemctl status cron

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–±—É
systemctl start cron
systemctl enable cron
```

### –õ–æ–≥–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
ls -la /opt/media-lab/logs

# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤—Ä—É—á–Ω—É—é
mkdir -p /opt/media-lab/logs
chmod 755 /opt/media-lab/logs
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ cron
grep CRON /var/log/syslog | tail -20
# –∏–ª–∏
journalctl -u cron | tail -20
```

