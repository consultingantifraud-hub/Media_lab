# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ 30 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö

## üéØ –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä)

–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –±–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ –≥—Ä—É–ø–ø–µ –¥–æ 30 —á–µ–ª–æ–≤–µ–∫.

---

## ‚úÖ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ Connection pooling –¥–ª—è HTTP –∫–ª–∏–µ–Ω—Ç–æ–≤
- ‚úÖ Redis connection pool
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### 2. –û—á–∏—Å—Ç–∫–∞ –∫–æ–¥–∞
- ‚úÖ –£–¥–∞–ª–µ–Ω –≤–µ—Å—å –≤–∏–¥–µ–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ –£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω docker-compose

### 3. –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
- ‚úÖ –ú–æ–¥—É–ª–∏ –¥–ª—è rate limiting –≥–æ—Ç–æ–≤—ã
- ‚úÖ –ú–æ–¥—É–ª–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ polling –≥–æ—Ç–æ–≤—ã
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤–∞

---

## üöÄ –ó–∞–ø—É—Å–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –®–∞–≥ 1: –ó–∞–ø—É—Å–∫ —Å –æ–¥–Ω–∏–º –≤–æ—Ä–∫–µ—Ä–æ–º

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# - redis (1 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
# - bot (1 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
# - worker-image (1 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
# - api (1 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0 –∏–ª–∏ –Ω–µ–±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ)
redis-cli LLEN rq:queue:img_queue

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
docker-compose logs -f bot

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–∞
docker-compose logs -f worker-image
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∑–∞–¥–∞—á–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

```bash
# –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 10 –¥–ª—è 30 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
redis-cli LLEN rq:queue:img_queue

# –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
redis-cli KEYS "rq:job:*" | wc -l

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Redis
redis-compose exec redis redis-cli INFO stats

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats
```

### –ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å:

1. **–†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏:**
   - –ù–æ—Ä–º–∞–ª—å–Ω–æ: 0-5 –∑–∞–¥–∞—á
   - –í–Ω–∏–º–∞–Ω–∏–µ: 5-10 –∑–∞–¥–∞—á
   - –ü—Ä–æ–±–ª–µ–º–∞: > 10 –∑–∞–¥–∞—á

2. **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
   - –ù–æ—Ä–º–∞–ª—å–Ω–æ: < 30 —Å–µ–∫—É–Ω–¥
   - –ü—Ä–∏–µ–º–ª–µ–º–æ: 30-60 —Å–µ–∫—É–Ω–¥
   - –ü—Ä–æ–±–ª–µ–º–∞: > 60 —Å–µ–∫—É–Ω–¥

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:**
   - CPU: < 70%
   - Memory: < 80%

---

## ‚öôÔ∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è 30 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä):

**–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è:**
- ‚úÖ 10-20 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ 20-30 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω–∏–∑–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é

**–ï—Å–ª–∏ –Ω–∞–≥—Ä—É–∑–∫–∞ –≤—ã—Å–æ–∫–∞—è:**
```bash
# –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ –æ–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä
docker-compose up -d --scale worker-image=2
```

### Rate Limiting (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

–î–æ–±–∞–≤—å—Ç–µ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞:

```python
from app.core.rate_limit import check_rate_limit

async def handle_create(message: types.Message, state: FSMContext) -> None:
    user_id = message.from_user.id if message.from_user else 0
    if not check_rate_limit(user_id):
        await message.answer("‚è≥ –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –º–∏–Ω—É—Ç—É.")
        return
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ rate limit:**
- –û–∫–Ω–æ: 60 —Å–µ–∫—É–Ω–¥
- –õ–∏–º–∏—Ç: 10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É

---

## üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å —Ä–∞—Å—Ç–µ—Ç:

1. **–î–æ–±–∞–≤–∏—Ç—å –≤–æ—Ä–∫–µ—Ä:**
   ```bash
   docker-compose up -d --scale worker-image=2
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   ```bash
   docker stats worker-image
   ```

3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å polling** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `app/core/polling_config.py`
   - –£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å 1 —Å–µ–∫ –¥–æ 2 —Å–µ–∫

### –ï—Å–ª–∏ –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ API:

1. –£–≤–µ–ª–∏—á–∏—Ç—å polling –∏–Ω—Ç–µ—Ä–≤–∞–ª (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `polling_config.py`)
2. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –≤–æ—Ä–∫–µ—Ä–æ–≤
3. –í–∫–ª—é—á–∏—Ç—å rate limiting

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

- [x] –ö–æ–¥ –æ—á–∏—â–µ–Ω –æ—Ç –≤–∏–¥–µ–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- [x] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [x] Docker-compose –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [x] Redis —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Rate limiting –¥–æ–±–∞–≤–ª–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üéØ –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –ü—Ä–∏ 30 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö —Å –æ–¥–Ω–∏–º –≤–æ—Ä–∫–µ—Ä–æ–º:

**–ù–æ—Ä–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:**
- –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏: 0-5 –∑–∞–¥–∞—á
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 20-40 —Å–µ–∫—É–Ω–¥
- CPU –≤–æ—Ä–∫–µ—Ä–∞: 30-50%
- Memory: 500MB-1GB

**–ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:**
- –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏: 5-10 –∑–∞–¥–∞—á
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 40-60 —Å–µ–∫—É–Ω–¥
- CPU –≤–æ—Ä–∫–µ—Ä–∞: 60-80%
- Memory: 1-1.5GB

**–ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å > 10 –∑–∞–¥–∞—á –ø–æ—Å—Ç–æ—è–Ω–Ω–æ:**
‚Üí –î–æ–±–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–π –≤–æ—Ä–∫–µ—Ä: `docker-compose up -d --scale worker-image=2`

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ 30 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö:

1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –î–ª—è 50-100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 2-3 –≤–æ—Ä–∫–µ—Ä–∞
   - –î–ª—è 100-200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 5-7 –≤–æ—Ä–∫–µ—Ä–æ–≤
   - –î–ª—è 200-300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 7-10 –≤–æ—Ä–∫–µ—Ä–æ–≤

2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
   - Rate limiting (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω)
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è polling –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

3. **Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥:** `REFACTORING_SUMMARY.md`
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:** `SCALING_PLAN_IMAGES_ONLY.md`
- **–í–Ω–µ–¥—Ä–µ–Ω–∏–µ:** `SCALING_IMPLEMENTATION_GUIDE.md`




