time="2025-11-22T07:07:28+03:00" level=warning msg="/opt/media-lab/deploy/docker-compose.prod.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
worker-image-1  | /usr/local/lib/python3.12/site-packages/click/core.py:1223: UserWarning: The parameter --serializer is used more than once. Remove its duplicate as parameters should be unique.
worker-image-1  |   parser = self.make_parser(ctx)
worker-image-1  | /usr/local/lib/python3.12/site-packages/click/core.py:1223: UserWarning: The parameter -S is used more than once. Remove its duplicate as parameters should be unique.
worker-image-1  |   parser = self.make_parser(ctx)
worker-image-1  | /usr/local/lib/python3.12/site-packages/click/core.py:1216: UserWarning: The parameter --serializer is used more than once. Remove its duplicate as parameters should be unique.
worker-image-1  |   self.parse_args(ctx, args)
worker-image-1  | /usr/local/lib/python3.12/site-packages/click/core.py:1216: UserWarning: The parameter -S is used more than once. Remove its duplicate as parameters should be unique.
worker-image-1  |   self.parse_args(ctx, args)
worker-image-1  | 03:41:58 Worker rq:worker:worker-image-1 started with PID 1, version 1.15.1
worker-image-1  | 03:41:58 Subscribing to channel rq:pubsub:worker-image-1
worker-image-1  | 03:41:58 *** Listening on img_queue...
worker-image-1  | 03:42:24 img_queue: app.workers.image_worker.process_smart_merge_job(image_sources=[{'url': 'https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5E..., job_id='81e7e7a601224bdf87d4803ffa76ee6f', options={'model': 'fal-ai/nano-banana-pro/edit', 'size': '1024x1024', 'aspect_ratio..., output_path='media/edits/image-smart-merge_2d8f8d8d.png', prompt='Фотореалистичный квадратный портрет 1:1. Используй фото мужчины как рефере...) (81e7e7a601224bdf87d4803ffa76ee6f)
worker-image-1  | 2025-11-22 03:42:27.806 | INFO     | app.workers.image_worker:process_smart_merge_job:1628 - Smart merge job 81e7e7a601224bdf87d4803ffa76ee6f: Nano-banana model detected, using original Russian prompt without translation
worker-image-1  | 2025-11-22 03:42:27.808 | INFO     | app.workers.image_worker:process_smart_merge_job:1647 - Processing smart merge job 81e7e7a601224bdf87d4803ffa76ee6f with 1 images, prompt='Фотореалистичный квадратный портрет 1:1. Используй фото мужчины как референс, сохрани его лицо, очки и выражение, но сделай образ чуть более неформальным: тот же мужчина в синем пиджаке и белой рубашке, рука лежит на спинке стула или в кармане, поза немного развёрнута боком к камере, лёгкая тёплая улыбка. Фон — уютный современный интерьер с мягким боке: стеллаж с книгами, растение, тёплый свет. Картинка должна передавать ощущение открытости и доверия, как у эксперта, к которому легко обратиться. Никаких надписей.', provider_prompt='Фотореалистичный квадратный портрет 1:1. Используй фото мужчины как референс, сохрани его лицо, очки и выражение, но сделай образ чуть более неформальным: тот же мужчина в синем пиджаке и белой рубашке, рука лежит на спинке стула или в кармане, поза немного развёрнута боком к камере, лёгкая тёплая улыбка. Фон — уютный современный интерьер с мягким боке: стеллаж с книгами, растение, тёплый свет. Картинка должна передавать ощущение открытости и доверия, как у эксперта, к которому легко обратиться. Никаких надписей.'
worker-image-1  | 2025-11-22 03:42:27.808 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: POST https://queue.fal.run/fal-ai/nano-banana-pro/edit payload={'prompt': 'Фотореалистичный квадратный портрет 1:1. Используй фото мужчины как референс, сохрани его лицо, очки и выражение, но сделай образ чуть более неформальным: тот же мужчина в синем пиджаке и белой рубашке, рука лежит на спинке стула или в кармане, поза немного развёрнута боком к камере, лёгкая тёплая улыбка. Фон — уютный современный интерьер с мягким боке: стеллаж с книгами, растение, тёплый свет. Картинка должна передавать ощущение открытости и доверия, как у эксперта, к которому легко обратиться. Никаких надписей.', 'width': 1024, 'height': 1024, 'aspect_ratio': '1:1', 'image_urls': ['https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5EpG8o9eBsCDm37I/documents/file_350.png'], 'image_url': 'https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5EpG8o9eBsCDm37I/documents/file_350.png'}
worker-image-1  | 2025-11-22 03:42:30.789 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/edit 200 -> {'status': 'IN_QUEUE', 'request_id': '29931b98-8290-4885-899c-36f81b76b15e', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/cancel', 'logs': None, 'metrics': {}, 'queue_position': 0}
worker-image-1  | 2025-11-22 03:42:30.790 | DEBUG    | app.providers.fal.images:submit_smart_merge:787 - fal submit_smart_merge response: {'status': 'IN_QUEUE', 'request_id': '29931b98-8290-4885-899c-36f81b76b15e', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/cancel', 'logs': None, 'metrics': {}, 'queue_position': 0}
worker-image-1  | 2025-11-22 03:42:30.790 | INFO     | app.workers.image_worker:process_smart_merge_job:1662 - Smart merge job 81e7e7a601224bdf87d4803ffa76ee6f submitted to queue with task_id: 29931b98-8290-4885-899c-36f81b76b15e
worker-image-1  | 2025-11-22 03:42:30.790 | INFO     | app.workers.image_worker:process_smart_merge_job:1697 - Smart merge job 81e7e7a601224bdf87d4803ffa76ee6f: Using 4s polling interval for nano-banana model
worker-image-1  | 2025-11-22 03:42:30.790 | INFO     | app.workers.image_worker:process_smart_merge_job:1705 - Smart merge job 81e7e7a601224bdf87d4803ffa76ee6f polling for task 29931b98-8290-4885-899c-36f81b76b15e completion
worker-image-1  | 2025-11-22 03:42:30.790 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status payload=None
worker-image-1  | 2025-11-22 03:42:30.933 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '29931b98-8290-4885-899c-36f81b76b15e', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:42:30.933 | DEBUG    | app.workers.image_worker:process_smart_merge_job:1727 - Smart merge job 81e7e7a601224bdf87d4803ffa76ee6f task 29931b98-8290-4885-899c-36f81b76b15e status: processing (attempt 1)
worker-image-1  | 2025-11-22 03:42:34.934 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status payload=None
worker-image-1  | 2025-11-22 03:42:35.077 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '29931b98-8290-4885-899c-36f81b76b15e', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:42:39.478 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status payload=None
worker-image-1  | 2025-11-22 03:42:39.620 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '29931b98-8290-4885-899c-36f81b76b15e', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:42:44.461 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status payload=None
worker-image-1  | 2025-11-22 03:42:44.603 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '29931b98-8290-4885-899c-36f81b76b15e', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:42:49.927 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status payload=None
worker-image-1  | 2025-11-22 03:42:50.071 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '29931b98-8290-4885-899c-36f81b76b15e', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:42:55.928 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status payload=None
worker-image-1  | 2025-11-22 03:42:56.072 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status 200 -> {'status': 'COMPLETED', 'request_id': '29931b98-8290-4885-899c-36f81b76b15e', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e/cancel', 'logs': None, 'metrics': {'inference_time': 23.79500102996826}}
worker-image-1  | 2025-11-22 03:42:56.073 | DEBUG    | app.providers.fal.images:check_status:1378 - fal status for 29931b98-8290-4885-899c-36f81b76b15e succeeded
worker-image-1  | 2025-11-22 03:42:56.073 | DEBUG    | app.providers.fal.images:_extract_from_obj:1428 - _extract_image_url: skipping queue API endpoint: https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e
worker-image-1  | 2025-11-22 03:42:56.073 | DEBUG    | app.workers.image_worker:process_smart_merge_job:1727 - Smart merge job 81e7e7a601224bdf87d4803ffa76ee6f task 29931b98-8290-4885-899c-36f81b76b15e status: succeeded (attempt 6)
worker-image-1  | 2025-11-22 03:42:56.073 | DEBUG    | app.providers.fal.images:_extract_from_obj:1428 - _extract_image_url: skipping queue API endpoint: https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e
worker-image-1  | 2025-11-22 03:42:56.573 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e payload=None
worker-image-1  | 2025-11-22 03:42:56.715 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e 200 -> {'images': [{'url': 'https://v3b.fal.media/files/b/panda/2WPAgvxIA6rGeqI0EYYbQ.png', 'content_type': 'image/png', 'file_name': '2WPAgvxIA6rGeqI0EYYbQ.png', 'file_size': None, 'width': None, 'height': None}], 'description': ''}
worker-image-1  | 2025-11-22 03:42:56.715 | DEBUG    | app.providers.fal.client:queue_result:233 - queue_result 29931b98-8290-4885-899c-36f81b76b15e succeeded on attempt 1 with candidate https://queue.fal.run/fal-ai/nano-banana-pro/requests/29931b98-8290-4885-899c-36f81b76b15e
worker-image-1  | 2025-11-22 03:42:56.715 | INFO     | app.providers.fal.images:resolve_result_asset:1527 - fal queue_result for 29931b98-8290-4885-899c-36f81b76b15e payload keys: ['images', 'description']
worker-image-1  | 2025-11-22 03:42:56.716 | INFO     | app.providers.fal.images:resolve_result_asset:1592 - Found image URL in candidate: https://v3b.fal.media/files/b/panda/2WPAgvxIA6rGeqI0EYYbQ.png (length: 61)
worker-image-1  | 2025-11-22 03:42:56.716 | INFO     | app.workers.image_worker:process_smart_merge_job:1801 - Smart merge job 81e7e7a601224bdf87d4803ffa76ee6f successfully got result on attempt 1: asset.url=https://v3b.fal.media/files/b/panda/2WPAgvxIA6rGeqI0EYYbQ.png, asset.content=False
worker-image-1  | 2025-11-22 03:42:56.716 | INFO     | app.workers.image_worker:process_smart_merge_job:1836 - Smart merge: image not downloaded, will send by URL: https://v3b.fal.media/files/b/panda/2WPAgvxIA6rGeqI0EYYbQ.png
worker-image-1  | 2025-11-22 03:42:56.717 | SUCCESS  | app.workers.image_worker:process_smart_merge_job:1856 - Smart merge job 81e7e7a601224bdf87d4803ffa76ee6f completed: https://v3b.fal.media/files/b/panda/2WPAgvxIA6rGeqI0EYYbQ.png
worker-image-1  | 03:42:58 img_queue: Job OK (81e7e7a601224bdf87d4803ffa76ee6f)
worker-image-1  | 03:42:58 Result is kept for 86400 seconds
worker-image-1  | 03:46:27 img_queue: app.workers.image_worker.process_smart_merge_job(image_sources=[{'url': 'https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5E..., job_id='3aaca3b5763b44cfa669fbde693c4615', options={'model': 'fal-ai/nano-banana-pro/edit', 'size': '1024x1024', 'aspect_ratio..., output_path='media/edits/image-smart-merge_8755ba4f.png', prompt='Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию ...) (3aaca3b5763b44cfa669fbde693c4615)
worker-image-1  | 2025-11-22 03:46:30.913 | INFO     | app.workers.image_worker:process_smart_merge_job:1628 - Smart merge job 3aaca3b5763b44cfa669fbde693c4615: Nano-banana model detected, using original Russian prompt without translation
worker-image-1  | 2025-11-22 03:46:30.914 | INFO     | app.workers.image_worker:process_smart_merge_job:1647 - Processing smart merge job 3aaca3b5763b44cfa669fbde693c4615 with 1 images, prompt='Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию мужчины как точный референс внешности: лысый мужчина 35–45 лет, светлая кожа, очки, доброжелательная улыбка. Сохрани черты лица и очки. Сцена: он идёт по футуристическому деловому кварталу, вокруг стеклянные небоскрёбы сложной формы, светящиеся линии и голографические панели, летающие дроны. На нём современный тёмно-синий костюм с лёгким футуристическим кроем и белая рубашка, без галстука. В небе мягкий закат, много отражений в стекле, неоново-голубые и фиолетовые акценты. Картинка яркая, детальная, без текстов и логотипов.', provider_prompt='Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию мужчины как точный референс внешности: лысый мужчина 35–45 лет, светлая кожа, очки, доброжелательная улыбка. Сохрани черты лица и очки. Сцена: он идёт по футуристическому деловому кварталу, вокруг стеклянные небоскрёбы сложной формы, светящиеся линии и голографические панели, летающие дроны. На нём современный тёмно-синий костюм с лёгким футуристическим кроем и белая рубашка, без галстука. В небе мягкий закат, много отражений в стекле, неоново-голубые и фиолетовые акценты. Картинка яркая, детальная, без текстов и логотипов.'
worker-image-1  | 2025-11-22 03:46:30.915 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: POST https://queue.fal.run/fal-ai/nano-banana-pro/edit payload={'prompt': 'Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию мужчины как точный референс внешности: лысый мужчина 35–45 лет, светлая кожа, очки, доброжелательная улыбка. Сохрани черты лица и очки. Сцена: он идёт по футуристическому деловому кварталу, вокруг стеклянные небоскрёбы сложной формы, светящиеся линии и голографические панели, летающие дроны. На нём современный тёмно-синий костюм с лёгким футуристическим кроем и белая рубашка, без галстука. В небе мягкий закат, много отражений в стекле, неоново-голубые и фиолетовые акценты. Картинка яркая, детальная, без текстов и логотипов.', 'width': 1024, 'height': 1024, 'aspect_ratio': '1:1', 'image_urls': ['https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5EpG8o9eBsCDm37I/documents/file_350.png'], 'image_url': 'https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5EpG8o9eBsCDm37I/documents/file_350.png'}
worker-image-1  | 2025-11-22 03:46:31.404 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/edit 200 -> {'status': 'IN_QUEUE', 'request_id': '8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/cancel', 'logs': None, 'metrics': {}, 'queue_position': 3}
worker-image-1  | 2025-11-22 03:46:31.404 | DEBUG    | app.providers.fal.images:submit_smart_merge:787 - fal submit_smart_merge response: {'status': 'IN_QUEUE', 'request_id': '8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/cancel', 'logs': None, 'metrics': {}, 'queue_position': 3}
worker-image-1  | 2025-11-22 03:46:31.405 | INFO     | app.workers.image_worker:process_smart_merge_job:1662 - Smart merge job 3aaca3b5763b44cfa669fbde693c4615 submitted to queue with task_id: 8d0ba55a-fe67-4a30-93cc-dac81bd904dd
worker-image-1  | 2025-11-22 03:46:31.405 | INFO     | app.workers.image_worker:process_smart_merge_job:1697 - Smart merge job 3aaca3b5763b44cfa669fbde693c4615: Using 4s polling interval for nano-banana model
worker-image-1  | 2025-11-22 03:46:31.405 | INFO     | app.workers.image_worker:process_smart_merge_job:1705 - Smart merge job 3aaca3b5763b44cfa669fbde693c4615 polling for task 8d0ba55a-fe67-4a30-93cc-dac81bd904dd completion
worker-image-1  | 2025-11-22 03:46:31.405 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status payload=None
worker-image-1  | 2025-11-22 03:46:31.548 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:46:31.548 | DEBUG    | app.workers.image_worker:process_smart_merge_job:1727 - Smart merge job 3aaca3b5763b44cfa669fbde693c4615 task 8d0ba55a-fe67-4a30-93cc-dac81bd904dd status: processing (attempt 1)
worker-image-1  | 2025-11-22 03:46:35.548 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status payload=None
worker-image-1  | 2025-11-22 03:46:35.691 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:46:40.092 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status payload=None
worker-image-1  | 2025-11-22 03:46:40.234 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:46:45.075 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status payload=None
worker-image-1  | 2025-11-22 03:46:45.217 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:46:50.541 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status payload=None
worker-image-1  | 2025-11-22 03:46:50.684 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:46:56.541 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status payload=None
worker-image-1  | 2025-11-22 03:46:56.684 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:46:56.684 | DEBUG    | app.workers.image_worker:process_smart_merge_job:1727 - Smart merge job 3aaca3b5763b44cfa669fbde693c4615 task 8d0ba55a-fe67-4a30-93cc-dac81bd904dd status: processing (attempt 6)
worker-image-1  | 2025-11-22 03:47:03.126 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status payload=None
worker-image-1  | 2025-11-22 03:47:03.271 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:47:10.357 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status payload=None
worker-image-1  | 2025-11-22 03:47:10.499 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:47:18.295 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status payload=None
worker-image-1  | 2025-11-22 03:47:18.440 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:47:27.015 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status payload=None
worker-image-1  | 2025-11-22 03:47:27.158 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status 200 -> {'status': 'COMPLETED', 'request_id': '8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd/cancel', 'logs': None, 'metrics': {'inference_time': 47.37470006942749}}
worker-image-1  | 2025-11-22 03:47:27.159 | DEBUG    | app.providers.fal.images:check_status:1378 - fal status for 8d0ba55a-fe67-4a30-93cc-dac81bd904dd succeeded
worker-image-1  | 2025-11-22 03:47:27.159 | DEBUG    | app.providers.fal.images:_extract_from_obj:1428 - _extract_image_url: skipping queue API endpoint: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd
worker-image-1  | 2025-11-22 03:47:27.159 | DEBUG    | app.workers.image_worker:process_smart_merge_job:1727 - Smart merge job 3aaca3b5763b44cfa669fbde693c4615 task 8d0ba55a-fe67-4a30-93cc-dac81bd904dd status: succeeded (attempt 10)
worker-image-1  | 2025-11-22 03:47:27.159 | DEBUG    | app.providers.fal.images:_extract_from_obj:1428 - _extract_image_url: skipping queue API endpoint: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd
worker-image-1  | 2025-11-22 03:47:27.659 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd payload=None
worker-image-1  | 2025-11-22 03:47:27.803 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd 200 -> {'images': [{'url': 'https://v3b.fal.media/files/b/tiger/Yi7TDdH4OGo-rQxT94jX9.png', 'content_type': 'image/png', 'file_name': 'Yi7TDdH4OGo-rQxT94jX9.png', 'file_size': None, 'width': 1024, 'height': 1024}], 'description': ''}
worker-image-1  | 2025-11-22 03:47:27.803 | DEBUG    | app.providers.fal.client:queue_result:233 - queue_result 8d0ba55a-fe67-4a30-93cc-dac81bd904dd succeeded on attempt 1 with candidate https://queue.fal.run/fal-ai/nano-banana-pro/requests/8d0ba55a-fe67-4a30-93cc-dac81bd904dd
worker-image-1  | 2025-11-22 03:47:27.803 | INFO     | app.providers.fal.images:resolve_result_asset:1527 - fal queue_result for 8d0ba55a-fe67-4a30-93cc-dac81bd904dd payload keys: ['images', 'description']
worker-image-1  | 2025-11-22 03:47:27.803 | INFO     | app.providers.fal.images:resolve_result_asset:1592 - Found image URL in candidate: https://v3b.fal.media/files/b/tiger/Yi7TDdH4OGo-rQxT94jX9.png (length: 61)
worker-image-1  | 2025-11-22 03:47:27.804 | INFO     | app.workers.image_worker:process_smart_merge_job:1801 - Smart merge job 3aaca3b5763b44cfa669fbde693c4615 successfully got result on attempt 1: asset.url=https://v3b.fal.media/files/b/tiger/Yi7TDdH4OGo-rQxT94jX9.png, asset.content=False
worker-image-1  | 2025-11-22 03:47:27.804 | INFO     | app.workers.image_worker:process_smart_merge_job:1836 - Smart merge: image not downloaded, will send by URL: https://v3b.fal.media/files/b/tiger/Yi7TDdH4OGo-rQxT94jX9.png
worker-image-1  | 2025-11-22 03:47:27.805 | SUCCESS  | app.workers.image_worker:process_smart_merge_job:1856 - Smart merge job 3aaca3b5763b44cfa669fbde693c4615 completed: https://v3b.fal.media/files/b/tiger/Yi7TDdH4OGo-rQxT94jX9.png
worker-image-1  | 03:47:29 img_queue: Job OK (3aaca3b5763b44cfa669fbde693c4615)
worker-image-1  | 03:47:29 Result is kept for 86400 seconds
worker-image-1  | 03:47:56 img_queue: app.workers.image_worker.process_smart_merge_job(image_sources=[{'url': 'https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5E..., job_id='856a4632945045f69ca9680aa02f79fc', options={'model': 'fal-ai/nano-banana-pro/edit', 'size': '1024x1024', 'aspect_ratio..., output_path='media/edits/image-smart-merge_48f50cc6.png', prompt='Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию ...) (856a4632945045f69ca9680aa02f79fc)
worker-image-1  | 2025-11-22 03:47:59.427 | INFO     | app.workers.image_worker:process_smart_merge_job:1628 - Smart merge job 856a4632945045f69ca9680aa02f79fc: Nano-banana model detected, using original Russian prompt without translation
worker-image-1  | 2025-11-22 03:47:59.429 | INFO     | app.workers.image_worker:process_smart_merge_job:1647 - Processing smart merge job 856a4632945045f69ca9680aa02f79fc with 1 images, prompt='Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию мужчины как референс внешности, сохрани его лицо и очки. Сцена: ночной Нью-Йорк, Таймс-сквер. Мужчина стоит на переднем плане в лёгком пальто или тёмно-синем пиджаке поверх белой рубашки, слегка улыбается, руки в карманах. На заднем плане яркие рекламные экраны, неон, огни машин и такси, люди в лёгком блюре. Все вывески и экраны без читаемых слов, только абстрактные световые пятна. Цвета насыщенные, много жёлтого, синего и розового, атмосфера большого города.', provider_prompt='Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию мужчины как референс внешности, сохрани его лицо и очки. Сцена: ночной Нью-Йорк, Таймс-сквер. Мужчина стоит на переднем плане в лёгком пальто или тёмно-синем пиджаке поверх белой рубашки, слегка улыбается, руки в карманах. На заднем плане яркие рекламные экраны, неон, огни машин и такси, люди в лёгком блюре. Все вывески и экраны без читаемых слов, только абстрактные световые пятна. Цвета насыщенные, много жёлтого, синего и розового, атмосфера большого города.'
worker-image-1  | 2025-11-22 03:47:59.429 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: POST https://queue.fal.run/fal-ai/nano-banana-pro/edit payload={'prompt': 'Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию мужчины как референс внешности, сохрани его лицо и очки. Сцена: ночной Нью-Йорк, Таймс-сквер. Мужчина стоит на переднем плане в лёгком пальто или тёмно-синем пиджаке поверх белой рубашки, слегка улыбается, руки в карманах. На заднем плане яркие рекламные экраны, неон, огни машин и такси, люди в лёгком блюре. Все вывески и экраны без читаемых слов, только абстрактные световые пятна. Цвета насыщенные, много жёлтого, синего и розового, атмосфера большого города.', 'width': 1024, 'height': 1024, 'aspect_ratio': '1:1', 'image_urls': ['https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5EpG8o9eBsCDm37I/documents/file_350.png'], 'image_url': 'https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5EpG8o9eBsCDm37I/documents/file_350.png'}
worker-image-1  | 2025-11-22 03:47:59.910 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/edit 200 -> {'status': 'IN_QUEUE', 'request_id': '181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/cancel', 'logs': None, 'metrics': {}, 'queue_position': 0}
worker-image-1  | 2025-11-22 03:47:59.910 | DEBUG    | app.providers.fal.images:submit_smart_merge:787 - fal submit_smart_merge response: {'status': 'IN_QUEUE', 'request_id': '181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/cancel', 'logs': None, 'metrics': {}, 'queue_position': 0}
worker-image-1  | 2025-11-22 03:47:59.910 | INFO     | app.workers.image_worker:process_smart_merge_job:1662 - Smart merge job 856a4632945045f69ca9680aa02f79fc submitted to queue with task_id: 181bb8e1-03d3-4e55-ad6f-1920f8a7992b
worker-image-1  | 2025-11-22 03:47:59.910 | INFO     | app.workers.image_worker:process_smart_merge_job:1697 - Smart merge job 856a4632945045f69ca9680aa02f79fc: Using 4s polling interval for nano-banana model
worker-image-1  | 2025-11-22 03:47:59.910 | INFO     | app.workers.image_worker:process_smart_merge_job:1705 - Smart merge job 856a4632945045f69ca9680aa02f79fc polling for task 181bb8e1-03d3-4e55-ad6f-1920f8a7992b completion
worker-image-1  | 2025-11-22 03:47:59.910 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status payload=None
worker-image-1  | 2025-11-22 03:48:00.054 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:48:00.055 | DEBUG    | app.workers.image_worker:process_smart_merge_job:1727 - Smart merge job 856a4632945045f69ca9680aa02f79fc task 181bb8e1-03d3-4e55-ad6f-1920f8a7992b status: processing (attempt 1)
worker-image-1  | 2025-11-22 03:48:04.055 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status payload=None
worker-image-1  | 2025-11-22 03:48:04.198 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:48:08.599 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status payload=None
worker-image-1  | 2025-11-22 03:48:08.744 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:48:13.585 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status payload=None
worker-image-1  | 2025-11-22 03:48:13.728 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:48:19.052 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status payload=None
worker-image-1  | 2025-11-22 03:48:19.195 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:48:25.052 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status payload=None
worker-image-1  | 2025-11-22 03:48:25.195 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:48:25.195 | DEBUG    | app.workers.image_worker:process_smart_merge_job:1727 - Smart merge job 856a4632945045f69ca9680aa02f79fc task 181bb8e1-03d3-4e55-ad6f-1920f8a7992b status: processing (attempt 6)
worker-image-1  | 2025-11-22 03:48:31.638 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status payload=None
worker-image-1  | 2025-11-22 03:48:31.783 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:48:38.869 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status payload=None
worker-image-1  | 2025-11-22 03:48:39.013 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status 202 -> {'status': 'IN_PROGRESS', 'request_id': '181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 03:48:46.809 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status payload=None
worker-image-1  | 2025-11-22 03:48:46.954 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status 200 -> {'status': 'COMPLETED', 'request_id': '181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b/cancel', 'logs': None, 'metrics': {'inference_time': 46.43958806991577}}
worker-image-1  | 2025-11-22 03:48:46.955 | DEBUG    | app.providers.fal.images:check_status:1378 - fal status for 181bb8e1-03d3-4e55-ad6f-1920f8a7992b succeeded
worker-image-1  | 2025-11-22 03:48:46.955 | DEBUG    | app.providers.fal.images:_extract_from_obj:1428 - _extract_image_url: skipping queue API endpoint: https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b
worker-image-1  | 2025-11-22 03:48:46.955 | DEBUG    | app.workers.image_worker:process_smart_merge_job:1727 - Smart merge job 856a4632945045f69ca9680aa02f79fc task 181bb8e1-03d3-4e55-ad6f-1920f8a7992b status: succeeded (attempt 9)
worker-image-1  | 2025-11-22 03:48:46.955 | DEBUG    | app.providers.fal.images:_extract_from_obj:1428 - _extract_image_url: skipping queue API endpoint: https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b
worker-image-1  | 2025-11-22 03:48:47.456 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b payload=None
worker-image-1  | 2025-11-22 03:48:47.599 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b 200 -> {'images': [{'url': 'https://v3b.fal.media/files/b/tiger/L9MRDpuq2BP9pDpWvYoDy.png', 'content_type': 'image/png', 'file_name': 'L9MRDpuq2BP9pDpWvYoDy.png', 'file_size': None, 'width': 1024, 'height': 1024}], 'description': ''}
worker-image-1  | 2025-11-22 03:48:47.599 | DEBUG    | app.providers.fal.client:queue_result:233 - queue_result 181bb8e1-03d3-4e55-ad6f-1920f8a7992b succeeded on attempt 1 with candidate https://queue.fal.run/fal-ai/nano-banana-pro/requests/181bb8e1-03d3-4e55-ad6f-1920f8a7992b
worker-image-1  | 2025-11-22 03:48:47.599 | INFO     | app.providers.fal.images:resolve_result_asset:1527 - fal queue_result for 181bb8e1-03d3-4e55-ad6f-1920f8a7992b payload keys: ['images', 'description']
worker-image-1  | 2025-11-22 03:48:47.599 | INFO     | app.providers.fal.images:resolve_result_asset:1592 - Found image URL in candidate: https://v3b.fal.media/files/b/tiger/L9MRDpuq2BP9pDpWvYoDy.png (length: 61)
worker-image-1  | 2025-11-22 03:48:47.599 | INFO     | app.workers.image_worker:process_smart_merge_job:1801 - Smart merge job 856a4632945045f69ca9680aa02f79fc successfully got result on attempt 1: asset.url=https://v3b.fal.media/files/b/tiger/L9MRDpuq2BP9pDpWvYoDy.png, asset.content=False
worker-image-1  | 2025-11-22 03:48:47.600 | INFO     | app.workers.image_worker:process_smart_merge_job:1836 - Smart merge: image not downloaded, will send by URL: https://v3b.fal.media/files/b/tiger/L9MRDpuq2BP9pDpWvYoDy.png
worker-image-1  | 2025-11-22 03:48:47.601 | SUCCESS  | app.workers.image_worker:process_smart_merge_job:1856 - Smart merge job 856a4632945045f69ca9680aa02f79fc completed: https://v3b.fal.media/files/b/tiger/L9MRDpuq2BP9pDpWvYoDy.png
worker-image-1  | 03:48:49 img_queue: Job OK (856a4632945045f69ca9680aa02f79fc)
worker-image-1  | 03:48:49 Result is kept for 86400 seconds
worker-image-1  | 03:55:34 Cleaning registries for queue: img_queue
worker-image-1  | 03:59:58 img_queue: app.workers.image_worker.process_smart_merge_job(image_sources=[{'url': 'https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5E..., job_id='42efa8305098432683dc0b37945ee149', options={'model': 'fal-ai/nano-banana/edit', 'size': '1024x1024', 'aspect_ratio': '..., output_path='media/edits/image-smart-merge_28135645.png', prompt='Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию ...) (42efa8305098432683dc0b37945ee149)
worker-image-1  | 2025-11-22 04:00:01.675 | INFO     | app.workers.image_worker:process_smart_merge_job:1628 - Smart merge job 42efa8305098432683dc0b37945ee149: Nano-banana model detected, using original Russian prompt without translation
worker-image-1  | 2025-11-22 04:00:01.677 | INFO     | app.workers.image_worker:process_smart_merge_job:1647 - Processing smart merge job 42efa8305098432683dc0b37945ee149 with 1 images, prompt='Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию мужчины как точный референс внешности: лысый мужчина 35–45 лет, светлая кожа, очки, доброжелательная улыбка. Сохрани черты лица и очки. Сцена: он идёт по футуристическому деловому кварталу, вокруг стеклянные небоскрёбы сложной формы, светящиеся линии и голографические панели, летающие дроны. На нём современный тёмно-синий костюм с лёгким футуристическим кроем и белая рубашка, без галстука. В небе мягкий закат, много отражений в стекле, неоново-голубые и фиолетовые акценты. Картинка яркая, детальная, без текстов и логотипов.', provider_prompt='Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию мужчины как точный референс внешности: лысый мужчина 35–45 лет, светлая кожа, очки, доброжелательная улыбка. Сохрани черты лица и очки. Сцена: он идёт по футуристическому деловому кварталу, вокруг стеклянные небоскрёбы сложной формы, светящиеся линии и голографические панели, летающие дроны. На нём современный тёмно-синий костюм с лёгким футуристическим кроем и белая рубашка, без галстука. В небе мягкий закат, много отражений в стекле, неоново-голубые и фиолетовые акценты. Картинка яркая, детальная, без текстов и логотипов.'
worker-image-1  | 2025-11-22 04:00:01.677 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: POST https://queue.fal.run/fal-ai/nano-banana/edit payload={'prompt': 'Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию мужчины как точный референс внешности: лысый мужчина 35–45 лет, светлая кожа, очки, доброжелательная улыбка. Сохрани черты лица и очки. Сцена: он идёт по футуристическому деловому кварталу, вокруг стеклянные небоскрёбы сложной формы, светящиеся линии и голографические панели, летающие дроны. На нём современный тёмно-синий костюм с лёгким футуристическим кроем и белая рубашка, без галстука. В небе мягкий закат, много отражений в стекле, неоново-голубые и фиолетовые акценты. Картинка яркая, детальная, без текстов и логотипов.', 'width': 1024, 'height': 1024, 'aspect_ratio': '1:1', 'image_urls': ['https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5EpG8o9eBsCDm37I/documents/file_350.png'], 'image_url': 'https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5EpG8o9eBsCDm37I/documents/file_350.png'}
worker-image-1  | 2025-11-22 04:00:02.162 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana/edit 200 -> {'status': 'IN_QUEUE', 'request_id': 'f5577d18-926d-4251-93e4-db1cd17788a1', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/cancel', 'logs': None, 'metrics': {}, 'queue_position': 1}
worker-image-1  | 2025-11-22 04:00:02.162 | DEBUG    | app.providers.fal.images:submit_smart_merge:787 - fal submit_smart_merge response: {'status': 'IN_QUEUE', 'request_id': 'f5577d18-926d-4251-93e4-db1cd17788a1', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/cancel', 'logs': None, 'metrics': {}, 'queue_position': 1}
worker-image-1  | 2025-11-22 04:00:02.163 | INFO     | app.workers.image_worker:process_smart_merge_job:1662 - Smart merge job 42efa8305098432683dc0b37945ee149 submitted to queue with task_id: f5577d18-926d-4251-93e4-db1cd17788a1
worker-image-1  | 2025-11-22 04:00:02.163 | INFO     | app.workers.image_worker:process_smart_merge_job:1697 - Smart merge job 42efa8305098432683dc0b37945ee149: Using 4s polling interval for nano-banana model
worker-image-1  | 2025-11-22 04:00:02.163 | INFO     | app.workers.image_worker:process_smart_merge_job:1705 - Smart merge job 42efa8305098432683dc0b37945ee149 polling for task f5577d18-926d-4251-93e4-db1cd17788a1 completion
worker-image-1  | 2025-11-22 04:00:02.163 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status payload=None
worker-image-1  | 2025-11-22 04:00:02.307 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status 202 -> {'status': 'IN_PROGRESS', 'request_id': 'f5577d18-926d-4251-93e4-db1cd17788a1', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 04:00:02.307 | DEBUG    | app.workers.image_worker:process_smart_merge_job:1727 - Smart merge job 42efa8305098432683dc0b37945ee149 task f5577d18-926d-4251-93e4-db1cd17788a1 status: processing (attempt 1)
worker-image-1  | 2025-11-22 04:00:06.308 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status payload=None
worker-image-1  | 2025-11-22 04:00:06.453 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status 202 -> {'status': 'IN_PROGRESS', 'request_id': 'f5577d18-926d-4251-93e4-db1cd17788a1', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 04:00:10.854 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status payload=None
worker-image-1  | 2025-11-22 04:00:10.996 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status 202 -> {'status': 'IN_PROGRESS', 'request_id': 'f5577d18-926d-4251-93e4-db1cd17788a1', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 04:00:15.837 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status payload=None
worker-image-1  | 2025-11-22 04:00:15.980 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status 200 -> {'status': 'COMPLETED', 'request_id': 'f5577d18-926d-4251-93e4-db1cd17788a1', 'response_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1', 'status_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/status', 'cancel_url': 'https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1/cancel', 'logs': None, 'metrics': {'inference_time': 8.808254957199097}}
worker-image-1  | 2025-11-22 04:00:15.981 | DEBUG    | app.providers.fal.images:check_status:1378 - fal status for f5577d18-926d-4251-93e4-db1cd17788a1 succeeded
worker-image-1  | 2025-11-22 04:00:15.981 | DEBUG    | app.providers.fal.images:_extract_from_obj:1428 - _extract_image_url: skipping queue API endpoint: https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1
worker-image-1  | 2025-11-22 04:00:15.981 | DEBUG    | app.workers.image_worker:process_smart_merge_job:1727 - Smart merge job 42efa8305098432683dc0b37945ee149 task f5577d18-926d-4251-93e4-db1cd17788a1 status: succeeded (attempt 4)
worker-image-1  | 2025-11-22 04:00:15.981 | DEBUG    | app.providers.fal.images:_extract_from_obj:1428 - _extract_image_url: skipping queue API endpoint: https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1
worker-image-1  | 2025-11-22 04:00:16.481 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1 payload=None
worker-image-1  | 2025-11-22 04:00:16.625 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1 200 -> {'images': [{'url': 'https://v3b.fal.media/files/b/rabbit/4itXncjST3uYlHXDv-IbS.png', 'content_type': 'image/png', 'file_name': '4itXncjST3uYlHXDv-IbS.png', 'file_size': None, 'width': None, 'height': None}], 'description': ''}
worker-image-1  | 2025-11-22 04:00:16.625 | DEBUG    | app.providers.fal.client:queue_result:233 - queue_result f5577d18-926d-4251-93e4-db1cd17788a1 succeeded on attempt 1 with candidate https://queue.fal.run/fal-ai/nano-banana/requests/f5577d18-926d-4251-93e4-db1cd17788a1
worker-image-1  | 2025-11-22 04:00:16.625 | INFO     | app.providers.fal.images:resolve_result_asset:1527 - fal queue_result for f5577d18-926d-4251-93e4-db1cd17788a1 payload keys: ['images', 'description']
worker-image-1  | 2025-11-22 04:00:16.626 | INFO     | app.providers.fal.images:resolve_result_asset:1592 - Found image URL in candidate: https://v3b.fal.media/files/b/rabbit/4itXncjST3uYlHXDv-IbS.png (length: 62)
worker-image-1  | 2025-11-22 04:00:16.626 | INFO     | app.workers.image_worker:process_smart_merge_job:1801 - Smart merge job 42efa8305098432683dc0b37945ee149 successfully got result on attempt 1: asset.url=https://v3b.fal.media/files/b/rabbit/4itXncjST3uYlHXDv-IbS.png, asset.content=False
worker-image-1  | 2025-11-22 04:00:16.626 | INFO     | app.workers.image_worker:process_smart_merge_job:1836 - Smart merge: image not downloaded, will send by URL: https://v3b.fal.media/files/b/rabbit/4itXncjST3uYlHXDv-IbS.png
worker-image-1  | 2025-11-22 04:00:16.627 | SUCCESS  | app.workers.image_worker:process_smart_merge_job:1856 - Smart merge job 42efa8305098432683dc0b37945ee149 completed: https://v3b.fal.media/files/b/rabbit/4itXncjST3uYlHXDv-IbS.png
worker-image-1  | 04:00:18 img_queue: Job OK (42efa8305098432683dc0b37945ee149)
worker-image-1  | 04:00:18 Result is kept for 86400 seconds
worker-image-1  | 04:00:55 img_queue: app.workers.image_worker.process_smart_merge_job(image_sources=[{'url': 'https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5E..., job_id='0be0b09f324249989553631f10e7e91a', options={'model': 'fal-ai/bytedance/seedream/v4/edit', 'size': '1024x1024', 'aspect..., output_path='media/edits/image-smart-merge_b8133ea1.png', prompt='Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию ...) (0be0b09f324249989553631f10e7e91a)
worker-image-1  | 2025-11-22 04:00:58.325 | INFO     | app.workers.image_worker:process_smart_merge_job:1647 - Processing smart merge job 0be0b09f324249989553631f10e7e91a with 1 images, prompt='Фотореалистичный квадратный портрет 1:1. Используй загруженную фотографию мужчины как точный референс внешности: лысый мужчина 35–45 лет, светлая кожа, очки, доброжелательная улыбка. Сохрани черты лица и очки. Сцена: он идёт по футуристическому деловому кварталу, вокруг стеклянные небоскрёбы сложной формы, светящиеся линии и голографические панели, летающие дроны. На нём современный тёмно-синий костюм с лёгким футуристическим кроем и белая рубашка, без галстука. В небе мягкий закат, много отражений в стекле, неоново-голубые и фиолетовые акценты. Картинка яркая, детальная, без текстов и логотипов.', provider_prompt='Photorealistic square portrait 1:1. Use the uploaded photo of a man as an accurate reference for his appearance: bald man, 35–45 years old, fair skin, glasses, friendly smile. Keep your facial features and glasses. Scene: he walks through a futuristic business district, surrounded by glass skyscrapers of complex shapes, glowing lines and holographic panels, flying drones. He is wearing a modern dark blue suit with a slightly futuristic cut and a white shirt, without a tie. There is a soft sunset in the sky, lots of reflections in the glass, neon blue and purple accents. The picture is bright, detailed, without texts or logos.. maintain realistic proportions and natural sizes.'
worker-image-1  | 2025-11-22 04:00:58.326 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: POST https://queue.fal.run/fal-ai/bytedance/seedream/v4/edit payload={'prompt': 'Photorealistic square portrait 1:1. Use the uploaded photo of a man as an accurate reference for his appearance: bald man, 35–45 years old, fair skin, glasses, friendly smile. Keep your facial features and glasses. Scene: he walks through a futuristic business district, surrounded by glass skyscrapers of complex shapes, glowing lines and holographic panels, flying drones. He is wearing a modern dark blue suit with a slightly futuristic cut and a white shirt, without a tie. There is a soft sunset in the sky, lots of reflections in the glass, neon blue and purple accents. The picture is bright, detailed, without texts or logos.. maintain realistic proportions and natural sizes.', 'width': 1024, 'height': 1024, 'aspect_ratio': '1:1', 'image_urls': ['https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5EpG8o9eBsCDm37I/documents/file_350.png'], 'image_url': 'https://api.telegram.org/file/bot8574040935:AAHgjmQ9K8hjN5KzIOF5EpG8o9eBsCDm37I/documents/file_350.png'}
worker-image-1  | 2025-11-22 04:00:58.800 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/bytedance/seedream/v4/edit 200 -> {'status': 'IN_QUEUE', 'request_id': 'c8e49bca-6c60-4af2-a1af-928586ed7540', 'response_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540', 'status_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status', 'cancel_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/cancel', 'logs': None, 'metrics': {}, 'queue_position': 0}
worker-image-1  | 2025-11-22 04:00:58.800 | DEBUG    | app.providers.fal.images:submit_smart_merge:787 - fal submit_smart_merge response: {'status': 'IN_QUEUE', 'request_id': 'c8e49bca-6c60-4af2-a1af-928586ed7540', 'response_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540', 'status_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status', 'cancel_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/cancel', 'logs': None, 'metrics': {}, 'queue_position': 0}
worker-image-1  | 2025-11-22 04:00:58.800 | INFO     | app.workers.image_worker:process_smart_merge_job:1662 - Smart merge job 0be0b09f324249989553631f10e7e91a submitted to queue with task_id: c8e49bca-6c60-4af2-a1af-928586ed7540
worker-image-1  | 2025-11-22 04:00:58.800 | INFO     | app.workers.image_worker:process_smart_merge_job:1705 - Smart merge job 0be0b09f324249989553631f10e7e91a polling for task c8e49bca-6c60-4af2-a1af-928586ed7540 completion
worker-image-1  | 2025-11-22 04:00:58.801 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status payload=None
worker-image-1  | 2025-11-22 04:00:58.944 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status 202 -> {'status': 'IN_PROGRESS', 'request_id': 'c8e49bca-6c60-4af2-a1af-928586ed7540', 'response_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540', 'status_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status', 'cancel_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 04:00:58.944 | DEBUG    | app.workers.image_worker:process_smart_merge_job:1727 - Smart merge job 0be0b09f324249989553631f10e7e91a task c8e49bca-6c60-4af2-a1af-928586ed7540 status: processing (attempt 1)
worker-image-1  | 2025-11-22 04:01:02.944 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status payload=None
worker-image-1  | 2025-11-22 04:01:03.088 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status 202 -> {'status': 'IN_PROGRESS', 'request_id': 'c8e49bca-6c60-4af2-a1af-928586ed7540', 'response_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540', 'status_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status', 'cancel_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 04:01:07.489 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status payload=None
worker-image-1  | 2025-11-22 04:01:07.632 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status 202 -> {'status': 'IN_PROGRESS', 'request_id': 'c8e49bca-6c60-4af2-a1af-928586ed7540', 'response_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540', 'status_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status', 'cancel_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 04:01:12.473 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status payload=None
worker-image-1  | 2025-11-22 04:01:12.614 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status 202 -> {'status': 'IN_PROGRESS', 'request_id': 'c8e49bca-6c60-4af2-a1af-928586ed7540', 'response_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540', 'status_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status', 'cancel_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 04:01:17.938 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status payload=None
worker-image-1  | 2025-11-22 04:01:18.080 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status 202 -> {'status': 'IN_PROGRESS', 'request_id': 'c8e49bca-6c60-4af2-a1af-928586ed7540', 'response_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540', 'status_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status', 'cancel_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/cancel', 'logs': None, 'metrics': {}}
worker-image-1  | 2025-11-22 04:01:23.937 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status payload=None
worker-image-1  | 2025-11-22 04:01:24.079 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status 200 -> {'status': 'COMPLETED', 'request_id': 'c8e49bca-6c60-4af2-a1af-928586ed7540', 'response_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540', 'status_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/status', 'cancel_url': 'https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540/cancel', 'logs': None, 'metrics': {'inference_time': 21.02073907852173}}
worker-image-1  | 2025-11-22 04:01:24.079 | DEBUG    | app.providers.fal.images:check_status:1378 - fal status for c8e49bca-6c60-4af2-a1af-928586ed7540 succeeded
worker-image-1  | 2025-11-22 04:01:24.080 | DEBUG    | app.providers.fal.images:_extract_from_obj:1428 - _extract_image_url: skipping queue API endpoint: https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540
worker-image-1  | 2025-11-22 04:01:24.080 | DEBUG    | app.workers.image_worker:process_smart_merge_job:1727 - Smart merge job 0be0b09f324249989553631f10e7e91a task c8e49bca-6c60-4af2-a1af-928586ed7540 status: succeeded (attempt 6)
worker-image-1  | 2025-11-22 04:01:24.080 | DEBUG    | app.providers.fal.images:_extract_from_obj:1428 - _extract_image_url: skipping queue API endpoint: https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540
worker-image-1  | 2025-11-22 04:01:24.580 | DEBUG    | app.providers.fal.client:_log_request:112 - fal request: GET https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540 payload=None
worker-image-1  | 2025-11-22 04:01:24.723 | DEBUG    | app.providers.fal.client:_log_response:116 - fal response: https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540 200 -> {'images': [{'url': 'https://v3b.fal.media/files/b/monkey/hiHrpAFZ12mQF1-bX77fE_ff0bc7e201bf4b72a66bf099fb693b45.png', 'content_type': 'image/png', 'file_name': 'ff0bc7e201bf4b72a66bf099fb693b45.png', 'file_size': 1135505, 'width': None, 'height': None}], 'seed': 1345187971}
worker-image-1  | 2025-11-22 04:01:24.723 | DEBUG    | app.providers.fal.client:queue_result:233 - queue_result c8e49bca-6c60-4af2-a1af-928586ed7540 succeeded on attempt 1 with candidate https://queue.fal.run/fal-ai/bytedance/requests/c8e49bca-6c60-4af2-a1af-928586ed7540
worker-image-1  | 2025-11-22 04:01:24.724 | INFO     | app.providers.fal.images:resolve_result_asset:1527 - fal queue_result for c8e49bca-6c60-4af2-a1af-928586ed7540 payload keys: ['images', 'seed']
worker-image-1  | 2025-11-22 04:01:24.724 | INFO     | app.providers.fal.images:resolve_result_asset:1592 - Found image URL in candidate: https://v3b.fal.media/files/b/monkey/hiHrpAFZ12mQF1-bX77fE_ff0bc7e201bf4b72a66bf099fb693b45.png (length: 95)
worker-image-1  | 2025-11-22 04:01:24.724 | INFO     | app.workers.image_worker:process_smart_merge_job:1801 - Smart merge job 0be0b09f324249989553631f10e7e91a successfully got result on attempt 1: asset.url=https://v3b.fal.media/files/b/monkey/hiHrpAFZ12mQF1-bX77fE_ff0bc7e201bf4b72a66bf099fb693b45.png, asset.content=False
worker-image-1  | 2025-11-22 04:01:24.724 | INFO     | app.workers.image_worker:process_smart_merge_job:1836 - Smart merge: image not downloaded, will send by URL: https://v3b.fal.media/files/b/monkey/hiHrpAFZ12mQF1-bX77fE_ff0bc7e201bf4b72a66bf099fb693b45.png
worker-image-1  | 2025-11-22 04:01:24.725 | SUCCESS  | app.workers.image_worker:process_smart_merge_job:1856 - Smart merge job 0be0b09f324249989553631f10e7e91a completed: https://v3b.fal.media/files/b/monkey/hiHrpAFZ12mQF1-bX77fE_ff0bc7e201bf4b72a66bf099fb693b45.png
worker-image-1  | 04:01:26 img_queue: Job OK (0be0b09f324249989553631f10e7e91a)
worker-image-1  | 04:01:26 Result is kept for 86400 seconds
