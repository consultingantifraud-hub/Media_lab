# –ü–ª–∞–Ω –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è 100-300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ vs –¢—Ä–µ–±—É–µ–º–æ–µ

**–¢–µ–∫—É—â–µ–µ:**
- 1 –±–æ—Ç-–ø—Ä–æ—Ü–µ—Å—Å (long polling)
- 1 –≤–æ—Ä–∫–µ—Ä –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤
- Polling –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É

**–¢—Ä–µ–±—É–µ–º–æ–µ –¥–ª—è 100-300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- 1-2 –∏–Ω—Å—Ç–∞–Ω—Å–∞ –±–æ—Ç–∞ (–∏–ª–∏ webhook)
- **7-10 –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π polling (2-3 —Å–µ–∫)
- Rate limiting (10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–µ–π

---

## üéØ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

### 1. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä –Ω–µ —Å–ø—Ä–∞–≤–∏—Ç—Å—è —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π 100-300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç—å 7-10 –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:**
```bash
docker-compose up -d --scale worker-image=7
```

**–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ docker-compose.scaled.yml:**
```bash
docker-compose -f docker-compose.yml -f docker/docker-compose.scaled.yml up -d
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤–æ—Ä–∫–µ—Ä–æ–≤:**
- **100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** 5 –≤–æ—Ä–∫–µ—Ä–æ–≤
- **200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** 7 –≤–æ—Ä–∫–µ—Ä–æ–≤
- **300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** 10 –≤–æ—Ä–∫–µ—Ä–æ–≤

**–§–æ—Ä–º—É–ª–∞:** `–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–≤–æ—Ä–∫–µ—Ä–æ–≤ = ceil(–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π / 30)`

---

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Polling –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:** Polling –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –ø—Ä–∏ 100-300 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö = 100-300 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫ –∫ API.

**–¢–µ–∫—É—â–µ–µ:** 1 —Å–µ–∫—É–Ω–¥–∞ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª)  
**–¢—Ä–µ–±—É–µ—Ç—Å—è:** 2-3 —Å–µ–∫—É–Ω–¥—ã —Å exponential backoff

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `app/core/polling_config.py`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª: 2 —Å–µ–∫—É–Ω–¥—ã
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª: 10 —Å–µ–∫—É–Ω–¥
- Exponential backoff —É–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ API
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ —Å 100-300 req/sec –¥–æ 20-50 req/sec

---

### 3. Rate Limiting –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–ø–∞–º–∏—Ç—å –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å —Å–∏—Å—Ç–µ–º—É.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `app/core/rate_limit.py`

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- **–û–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏:** 60 —Å–µ–∫—É–Ω–¥
- **–ú–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤:** 10 –≤ –º–∏–Ω—É—Ç—É
- –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤–æ –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
- `handle_create` (—Å–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
- `handle_edit_start` (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- `handle_smart_merge_start` (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ)
- `handle_retoucher_start` (—Ä–µ—Ç—É—à—å)
- `handle_upscale_button` (—É–ª—É—á—à–µ–Ω–∏–µ)

---

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Redis ‚ö†Ô∏è –í–ê–ñ–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ Redis –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º.

**–†–µ—à–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Redis –¥–ª—è production

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—É–∂–µ –≤ docker-compose.scaled.yml):**
```yaml
redis:
  command: >
    redis-server
    --maxmemory 2gb
    --maxmemory-policy allkeys-lru
    --save 60 1000
    --appendonly yes
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `maxmemory 2gb` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- `allkeys-lru` - —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∫–ª—é—á–µ–π –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –ø–∞–º—è—Ç–∏
- `appendonly yes` - –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

---

## üîß –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–µ–π ‚ö†Ô∏è –í–ê–ñ–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑ –º–µ—Ç—Ä–∏–∫.

**–ë–∞–∑–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—á–µ—Ä–µ–∑ Redis CLI):**
```bash
# –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
redis-cli LLEN rq:queue:img_queue

# –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
redis-cli KEYS "rq:job:*" | wc -l

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Redis
redis-cli INFO stats
```

**–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus + Grafana):**
- –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–µ–π
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤–æ—Ä–∫–µ—Ä–æ–≤
- Rate limit —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

---

### 6. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç–∞–Ω—Å–∞—Ö.

**–í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è:**

**A. –û–±—â–∏–π NFS volume (–ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç):**
```yaml
volumes:
  media-storage:
    driver: local
    driver_opts:
      type: nfs
      o: addr=nfs-server,nolock,soft
      device: ":/media"
```

**B. S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç):**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MinIO –∏–ª–∏ AWS S3
- –í—Å–µ –≤–æ—Ä–∫–µ—Ä—ã –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ –æ–¥–Ω–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

---

### 7. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ.

**–†–µ—à–µ–Ω–∏–µ:** –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Redis

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ fal.ai API
- –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** (—Å–º. SCALING_PLAN_100-300_USERS.md, —Ä–∞–∑–¥–µ–ª 8)

---

### 8. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –∑–∞–¥–∞—á–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ RQ

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–æ—Ä–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è batch –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üìã –ü–û–®–ê–ì–û–í–´–ô –ü–õ–ê–ù –í–ù–ï–î–†–ï–ù–ò–Ø

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (1 –¥–µ–Ω—å)

1. ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤**
   ```bash
   docker-compose up -d --scale worker-image=7
   ```
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å 7 –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

2. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è polling**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `app/core/polling_config.py`
   - –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ polling –≤ `image_worker.py`
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

3. ‚úÖ **Rate limiting**
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–∏–º–∏—Ç—ã (10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É)
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –§–∞–∑–∞ 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (2-3 –¥–Ω—è)

4. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Redis**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å maxmemory –∏ –ø–æ–ª–∏—Ç–∏–∫—É
   - –í–∫–ª—é—á–∏—Ç—å persistence
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

5. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Redis CLI
   - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: Prometheus + Grafana
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã

### –§–∞–∑–∞ 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (1 –Ω–µ–¥–µ–ª—è)

6. ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å TTL
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å hit rate

7. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—â–∏–π volume –∏–ª–∏ S3
   - –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã

---

## üñ•Ô∏è –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–ê–Ø –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è 100-300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

**VPS/–°–µ—Ä–≤–µ—Ä:**
- **CPU:** 8-12 —è–¥–µ—Ä (–¥–ª—è 7-10 –≤–æ—Ä–∫–µ—Ä–æ–≤)
- **RAM:** 16-24 GB
  - Redis: 2-4 GB
  - –í–æ—Ä–∫–µ—Ä—ã: 2 GB √ó 7-10 = 14-20 GB
  - –°–∏—Å—Ç–µ–º–∞: 2 GB
- **–î–∏—Å–∫:** 200+ GB SSD (–∏–ª–∏ S3 –¥–ª—è –º–µ–¥–∏–∞)
- **–°–µ—Ç—å:** –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, –º–∏–Ω–∏–º—É–º 100 Mbps

**Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```yaml
services:
  redis:
    # ... —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –≤—ã—à–µ
    
  bot:
    # 1 –∏–Ω—Å—Ç–∞–Ω—Å (–∏–ª–∏ webhook)
    deploy:
      replicas: 1
      
  worker-image:
    # 7-10 –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
    deploy:
      replicas: 7
      resources:
        limits:
          cpus: '2'
          memory: 2G
```

---

## üìä –û–ñ–ò–î–ê–ï–ú–ê–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### –ü–æ—Å–ª–µ –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π:

- **100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ (5 –≤–æ—Ä–∫–µ—Ä–æ–≤)
- **200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ (7 –≤–æ—Ä–∫–µ—Ä–æ–≤)
- **300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (10 –≤–æ—Ä–∫–µ—Ä–æ–≤)

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

- **–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á–∏:** < 30 —Å–µ–∫—É–Ω–¥
- **–†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏:** < 50 –∑–∞–¥–∞—á
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU:** < 70%
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:** < 80%
- **–û—à–∏–±–∫–∏:** < 1%

### –†–∞—Å—á–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏:

**–ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è:**
- –°—Ä–µ–¥–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: 5-10 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 20-30 —Å–µ–∫—É–Ω–¥
- –ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: 2x –æ—Ç —Å—Ä–µ–¥–Ω–µ–π

**100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞: 100 √ó 7.5 / 3600 = 0.2 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫
- –ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: 0.4 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫
- –ù—É–∂–Ω–æ –≤–æ—Ä–∫–µ—Ä–æ–≤: ceil(0.4 √ó 30) = 12 —Å–µ–∫—É–Ω–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ = **5 –≤–æ—Ä–∫–µ—Ä–æ–≤**

**200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞: 0.4 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫
- –ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: 0.8 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫
- –ù—É–∂–Ω–æ –≤–æ—Ä–∫–µ—Ä–æ–≤: **7 –≤–æ—Ä–∫–µ—Ä–æ–≤**

**300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞: 0.6 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫
- –ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: 1.2 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫
- –ù—É–∂–Ω–æ –≤–æ—Ä–∫–µ—Ä–æ–≤: **10 –≤–æ—Ä–∫–µ—Ä–æ–≤**

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

### –î–ª—è 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
```bash
docker-compose up -d --scale worker-image=5
```

### –î–ª—è 200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
```bash
docker-compose up -d --scale worker-image=7
```

### –î–ª—è 300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
```bash
docker-compose up -d --scale worker-image=10
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
# –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏
redis-cli LLEN rq:queue:img_queue

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
docker-compose ps | grep worker-image | wc -l

# –õ–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤
docker-compose logs -f worker-image
```

---

## ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ê –ü–ê–†–ê–ú–ï–¢–†–û–í

### Rate Limiting:
```python
# app/core/rate_limit.py
RATE_LIMIT_WINDOW = 60        # –û–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ (—Å–µ–∫—É–Ω–¥—ã)
RATE_LIMIT_MAX_REQUESTS = 10  # –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤
```

### Polling:
```python
# app/core/polling_config.py
POLL_INTERVAL_INITIAL = 2.0   # –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
POLL_INTERVAL_MAX = 10.0      # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
```

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤:
- **100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** 5 –≤–æ—Ä–∫–µ—Ä–æ–≤
- **200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** 7 –≤–æ—Ä–∫–µ—Ä–æ–≤  
- **300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** 10 –≤–æ—Ä–∫–µ—Ä–æ–≤

---

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ 100-300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π **—Ç–æ–ª—å–∫–æ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏** –Ω—É–∂–Ω–æ:

1. ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –≤–æ—Ä–∫–µ—Ä—ã** (5-10 –≤–æ—Ä–∫–µ—Ä–æ–≤)
2. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å polling** (2-3 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 1 —Å–µ–∫)
3. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å rate limiting** (10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É)
4. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Redis** (maxmemory, persistence)

**–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è** (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, S3, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥) –º–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä—è—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.

**–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ:** –ù–∞—á–Ω–∏—Ç–µ —Å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ—Ä–∫–µ—Ä–æ–≤ - —ç—Ç–æ –¥–∞—Å—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç!




