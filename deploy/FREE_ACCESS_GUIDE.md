# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º—É –¥–æ—Å—Ç—É–ø—É –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìã –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–∞ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏ –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤.

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º:

1. –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ
2. –ù–µ —Ç—Ä–∞—Ç—è—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
3. –ù–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å
4. –û–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ `FREE` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –ê–∫—Ç–∏–≤–∞—Ü–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –ø—Ä–æ–º–æ–∫–æ–¥ FREE_ACCESS

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–º–∞–Ω–¥—É `/balance`
2. –í—ã–±–∏—Ä–∞–µ—Ç "üéüÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π"
3. –í–≤–æ–¥–∏—Ç –ø—Ä–æ–º–æ–∫–æ–¥ `FREE_ACCESS`
4. –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ –ë–î (–¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

```sql
-- –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ telegram_id
UPDATE users 
SET has_free_access = true 
WHERE telegram_id = YOUR_TELEGRAM_ID;
```

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç

```python
from app.db.base import SessionLocal
from app.db.models import User

db = SessionLocal()

# –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ telegram_id
user = db.query(User).filter(User.telegram_id == YOUR_TELEGRAM_ID).first()

if user:
    user.has_free_access = True
    db.commit()
    print(f"Free access activated for user {user.telegram_id}")
else:
    print("User not found")

db.close()
```

## üìä –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–ª–∞—Ç–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏:

1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ñ–ª–∞–≥ `has_free_access`
2. –ï—Å–ª–∏ `true` ‚Üí –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ, —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `FREE` –∏ `price = 0`
3. –ï—Å–ª–∏ `false` ‚Üí –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∑–∞—Ç–µ–º –±–∞–ª–∞–Ω—Å

### –í –∫–æ–º–∞–Ω–¥–µ /balance:

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –≤–∏–¥—è—Ç: "‚ú® **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø:** –ê–∫—Ç–∏–≤–µ–Ω"
- –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –±–∞–ª–∞–Ω—Å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üéüÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥ FREE_ACCESS

–ü—Ä–æ–º–æ–∫–æ–¥ `FREE_ACCESS` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤:

```bash
python scripts/init_discount_codes.py
```

### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞:

- `code`: "FREE_ACCESS"
- `discount_percent`: 0
- `is_free_generation`: false
- `free_generations_count`: None (unlimited)
- `max_uses`: None (–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ß–µ—Ä–µ–∑ SQL:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø
SELECT telegram_id, has_free_access, free_operations_left
FROM users
WHERE telegram_id = YOUR_TELEGRAM_ID;
```

### –ß–µ—Ä–µ–∑ Python:

```python
from app.services.billing import BillingService
from app.db.base import SessionLocal

db = SessionLocal()
user_info = BillingService.get_user_info(db, YOUR_TELEGRAM_ID)

if user_info:
    if user_info.get("has_free_access"):
        print("User has free access")
    else:
        print(f"User balance: {user_info['balance']}‚ÇΩ")
        print(f"Free operations: {user_info['free_operations_left']}")
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–∫—Ç–∏–≤–∞—Ü–∏—è –¥–ª—è —Å–µ–±—è (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)

```python
from app.db.base import SessionLocal
from app.db.models import User
from app.services.billing import BillingService

db = SessionLocal()

# –ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user, _ = BillingService.get_or_create_user(db, YOUR_TELEGRAM_ID)

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø
user.has_free_access = True
db.commit()

print("Free access activated!")
db.close()
```

### –ü—Ä–∏–º–µ—Ä 2: –ê–∫—Ç–∏–≤–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø—Ä–æ–º–æ–∫–æ–¥

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–º–æ–∫–æ–¥ FREE_ACCESS —Å–æ–∑–¥–∞–Ω
2. –í –±–æ—Ç–µ: `/balance` ‚Üí "–ü—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π" ‚Üí `FREE_ACCESS`
3. –î–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω

### –ü—Ä–∏–º–µ—Ä 3: –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

```sql
-- –û—Ç–∫–ª—é—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø
UPDATE users 
SET has_free_access = false 
WHERE telegram_id = YOUR_TELEGRAM_ID;
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–º–æ–∫–æ–¥ FREE_ACCESS –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–æ–º–æ–∫–æ–¥ —Å–æ–∑–¥–∞–Ω:
   ```sql
   SELECT * FROM discount_codes WHERE code = 'FREE_ACCESS';
   ```

2. –ï—Å–ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ:
   ```python
   python scripts/init_discount_codes.py
   ```

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ –µ—â–µ –ø–ª–∞—Ç–∏—Ç –∑–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–ª–∞–≥ `has_free_access`:
   ```sql
   SELECT has_free_access FROM users WHERE telegram_id = YOUR_TELEGRAM_ID;
   ```

2. –ï—Å–ª–∏ `false`, –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –¥–æ—Å—Ç—É–ø (—Å–º. –≤—ã—à–µ)

### –ù—É–∂–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```sql
-- –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Å–ø–∏—Å–∫–∞ telegram_id
UPDATE users 
SET has_free_access = true 
WHERE telegram_id IN (123456789, 987654321, 111222333);
```

## üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

### –ü–æ–ª–µ `has_free_access` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`:

- –¢–∏–ø: `Boolean`
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `false`
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û—Ç–º–µ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é: `alembic upgrade head`
- [ ] –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ FREE_ACCESS: `python scripts/init_discount_codes.py`
- [ ] –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–ª—è —Å–µ–±—è (—á–µ—Ä–µ–∑ –ø—Ä–æ–º–æ–∫–æ–¥ –∏–ª–∏ –ë–î)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/balance` (–¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø: –ê–∫—Ç–∏–≤–µ–Ω")



