#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –Ω–∞ GitHub —Å —Å–µ—Ä–≤–µ—Ä–∞

REPO_DIR="/opt/media-lab"
GITHUB_REPO="https://github.com/consultingantifraud-hub/Media_lab"

echo "=== –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ GitHub ==="
echo ""

cd "$REPO_DIR" || { echo "‚ùå –û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–π—Ç–∏ –≤ $REPO_DIR"; exit 1; }

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
echo "1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞..."
git status --short

# 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
echo ""
echo "2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏–Ω–¥–µ–∫—Å..."
git add -A

CHANGES=$(git status --short | wc -l)
if [ "$CHANGES" -eq 0 ]; then
    echo "‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∞–∫—Ç—É–∞–ª–µ–Ω."
    exit 0
fi

# 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –±—É–¥–µ—Ç –∑–∞–∫–æ–º–º–∏—á–µ–Ω–æ
echo ""
echo "3. –ò–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã:"
git status --short | head -20
if [ "$CHANGES" -gt 20 ]; then
    echo "... –∏ –µ—â–µ $((CHANGES - 20)) —Ñ–∞–π–ª–æ–≤"
fi

# 4. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
echo ""
read -p "4. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–∏—Ç? (y/n): " CONFIRM
if [ "$CONFIRM" != "y" ] && [ "$CONFIRM" != "Y" ]; then
    echo "–û—Ç–º–µ–Ω–∞. –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∏–Ω–¥–µ–∫—Å, –Ω–æ –Ω–µ –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã."
    exit 0
fi

read -p "–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ (–∏–ª–∏ Enter –¥–ª—è –∞–≤—Ç–æ): " COMMIT_MSG
if [ -z "$COMMIT_MSG" ]; then
    COMMIT_MSG="Update: server changes $(date '+%Y-%m-%d %H:%M:%S')"
fi

echo "–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞: $COMMIT_MSG"
git commit -m "$COMMIT_MSG"

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–º–∏—Ç–∞."
    exit 1
fi

# 5. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ GitHub
echo ""
echo "5. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ GitHub..."
git push origin main

if [ $? -eq 0 ]; then
    echo ""
    echo "‚úÖ –£–°–ü–ï–•! –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ GitHub!"
    echo ""
    echo "üìã –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: $GITHUB_REPO"
    echo "üìù –ö–æ–º–º–∏—Ç: $(git log -1 --oneline)"
else
    echo ""
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞ GitHub."
    echo "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é: git push origin main"
    exit 1
fi

echo ""
echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"

