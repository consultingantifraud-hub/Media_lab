# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è 100-300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

## üöÄ –ó–∞ 5 –º–∏–Ω—É—Ç –¥–æ production-ready

### –®–∞–≥ 1: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤

```bash
# –î–ª—è 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
docker-compose up -d --scale worker-image=5

# –î–ª—è 200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
docker-compose up -d --scale worker-image=7

# –î–ª—è 300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
docker-compose up -d --scale worker-image=10
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
docker-compose ps | grep worker-image | wc -l

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 5, 7 –∏–ª–∏ 10 –≤–æ—Ä–∫–µ—Ä–æ–≤
```

---

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏

```bash
# –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 50)
redis-cli LLEN rq:queue:img_queue

# –ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å —Ä–∞—Å—Ç–µ—Ç - –¥–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –≤–æ—Ä–∫–µ—Ä–æ–≤
```

---

### –®–∞–≥ 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –õ–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤
docker-compose logs -f worker-image

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Redis
redis-cli INFO stats
```

---

## üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤–æ—Ä–∫–µ—Ä–æ–≤

| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | –í–æ—Ä–∫–µ—Ä–æ–≤ | –ö–æ–º–∞–Ω–¥–∞ |
|-------------|----------|---------|
| 50-100      | 5        | `--scale worker-image=5` |
| 100-200     | 7        | `--scale worker-image=7` |
| 200-300     | 10       | `--scale worker-image=10` |

**–§–æ—Ä–º—É–ª–∞:** `–≤–æ—Ä–∫–µ—Ä–æ–≤ = ceil(–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π / 30)`

---

## ‚öôÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### Rate Limiting (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)

–î–æ–±–∞–≤—å—Ç–µ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (`app/bot/handlers/image.py`):

```python
from app.core.rate_limit import check_rate_limit

async def handle_create(message: types.Message, state: FSMContext) -> None:
    user_id = message.from_user.id if message.from_user else 0
    if not check_rate_limit(user_id):
        await message.answer("‚è≥ –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –º–∏–Ω—É—Ç—É.")
        return
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Polling

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `app/core/polling_config.py` –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API.

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:
- ‚úÖ **100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** –°—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** –°—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç  
- ‚úÖ **300 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** –†–∞–±–æ—Ç–∞–µ—Ç, –≤–æ–∑–º–æ–∂–Ω—ã –ø–∏–∫–æ–≤—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏

**–ú–µ—Ç—Ä–∏–∫–∏:**
- –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏: < 50 –∑–∞–¥–∞—á
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: < 30 —Å–µ–∫—É–Ω–¥
- –û—à–∏–±–∫–∏: < 1%

---

## üîß Troubleshooting

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—á–µ—Ä–µ–¥—å —Ä–∞—Å—Ç–µ—Ç (> 100 –∑–∞–¥–∞—á)
```bash
# –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –≤–æ—Ä–∫–µ—Ä–æ–≤
docker-compose up -d --scale worker-image=10
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
```bash
# –†–µ—à–µ–Ω–∏–µ: –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø–∞–º—è—Ç—å –≤–æ—Ä–∫–µ—Ä–æ–≤ –≤ docker-compose.yml
# –î–æ–±–∞–≤—å—Ç–µ: mem_limit: 2g
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```bash
# –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤ –∏ —É–≤–µ–ª–∏—á—å—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
docker-compose ps | grep worker-image
```

---

## üìù –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–π—Ç–µ –≤–æ—Ä–∫–µ—Ä—ã (—Å–¥–µ–ª–∞–Ω–æ –≤—ã—à–µ)
2. ‚è≠Ô∏è –î–æ–±–∞–≤—å—Ç–µ rate limiting (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)
3. ‚è≠Ô∏è –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ polling (—Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API)
4. ‚è≠Ô∏è –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus/Grafana)

**–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:** –°–º. `SCALING_PLAN_IMAGES_ONLY.md`




